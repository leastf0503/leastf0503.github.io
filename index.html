<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VitalCore - Ihr Gesundheitsportal</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @keyframes slide-up { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        @keyframes pulse-slow { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes blink { 0%, 88%, 100% { transform: scaleY(1); } 92% { transform: scaleY(0.05); } }
        .animate-blink-1 { animation: blink 2.5s infinite; transform-origin: center; }
        .animate-slide-up { animation: slide-up 0.5s ease-out forwards; }
        .animate-fade-in { animation: fade-in 0.8s ease-out forwards; }
        .animate-pulse-slow { animation: pulse-slow 3s infinite; }
        .animate-spin-slow { animation: spin 3s linear infinite; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8fafc; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        #error-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; padding: 20px; background: #fee2e2; border-bottom: 2px solid #ef4444; color: #991b1b; z-index: 9999; font-family: monospace; }
    </style>
</head>
<body>

    <div id="error-overlay">
        <strong>Systemfehler:</strong> <span id="error-msg">Unbekannter Fehler</span>
    </div>
    <script>
        window.onerror = function(msg, url, line, col, error) {
            document.getElementById('error-overlay').style.display = 'block';
            document.getElementById('error-msg').innerText = msg + " (Zeile: " + line + ")";
            return false;
        };
    </script>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // 1. KONFIGURATION
        const MIN_BROWSING_TIME_1 = 60; 
        const MIN_REGISTRATION_TIME = 20; 
        const MIN_BROWSING_TIME_2 = 40; 
        const COOKIE_BANNER_DELAY_MS = 3000; 
        const SOSCI_BASE_URL = "https://www.soscisurvey.de/BA25LeaPaula/";

        // 2. ICONS
        const Icon = ({ path, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{path}</svg>
        );

        const paths = {
            shield: <React.Fragment><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="M12 8v4"/><path d="M12 16h.01"/></React.Fragment>,
            check: <React.Fragment><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></React.Fragment>,
            search: <React.Fragment><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></React.Fragment>,
            arrowLeft: <path d="M19 12H5m7 7-7-7 7-7"/>,
            leaf: <path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z" />,
            clock: <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>,
            activity: <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>,
            heart: <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>,
            heartFilled: <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" fill="currentColor" stroke="none"/>,
        };

        // 3. DATEN (Wiederhergestellt: Vollständige Texte)
        const BLOG_CONTENT = [
            { 
                id: 1, title: "Die 5 Säulen Ihrer Langlebigkeit", cat: "Forschung", time: "12 min", date: "Aktuell", author: "Dr. med. Weber", 
                image: "https://images.unsplash.com/photo-1476480862126-209bfaa8edc8?auto=format&fit=crop&w=800", 
                desc: "Erfahren Sie, wie kleine Anpassungen in Ihrer täglichen Routine Ihr biologisches Alter messbar senken können.", 
                fullText: [
                    "Die moderne Altersforschung hat in den letzten Jahren bahnbrechende Erkenntnisse geliefert: Ihr biologisches Alter ist kein feststehender Wert, sondern das Resultat Ihrer täglichen Entscheidungen. Während die Genetik lediglich die 'geladene Waffe' darstellt, ist es Ihr Lebensstil, der letztlich den Abzug drückt. Wir sprechen hier von Epigenetik – der Fähigkeit, durch äußere Einflüsse zu bestimmen, welche Gene in Ihrem Körper aktiv geschaltet werden und welche stumm bleiben.",
                    "Die erste Säule bildet die Ernährung. Es geht hierbei weniger um strikten Verzicht oder kurzfristige Diäten, sondern um die Qualität der molekularen Information, die Sie Ihren Zellen zuführen. Phyto-Nährstoffe wie Resveratrol aktivieren Sirtuine, welche Reparaturprozesse an der DNA einleiten.",
                    "Zweitens spielt die moderate Bewegung eine entscheidende Rolle für die vaskuläre Integrität. Schon 30 Minuten zügiges Gehen täglich lösen die Ausschüttung von Stickstoffmonoxid aus, was die Gefäßwände entspannt.",
                    "Die dritte Säule ist die Schlafhygiene. Während Sie schlafen, wird das sogenannte glympathische System aktiv – eine Art Selbstreinigung des Gehirns.",
                    "Viertens: Stressmanagement. Chronisch hohes Cortisol ist ein Zellgift-Cocktail. Er schwächt das Immunsystem und baut Muskulatur ab.",
                    "Fünftens: Soziale Resonanz. Statistiken aus den 'Blue Zones' belegen, dass Menschen in stabilen sozialen Gefügen deutlich seltener an chronischen Krankheiten leiden.",
                    "Zusammenfassend lässt sich sagen: Langlebigkeit ist kein Zufallsprodukt, sondern die Summe Ihrer täglichen Gewohnheiten."
                ] 
            },
            { 
                id: 2, title: "Intervallfasten 16:8 für Einsteiger", cat: "Ernährung", time: "10 min", date: "10. Okt", author: "Sarah Klein", 
                image: "https://images.unsplash.com/photo-1498837167922-ddd27525d352?auto=format&fit=crop&w=800", 
                desc: "Warum zeitlich begrenzte Esspausen für Ihren Stoffwechsel wertvoller sind als jede klassische Kalorien-Diät.", 
                fullText: [
                    "Haben Sie sich schon einmal gefragt, warum Ihr Körper ständig Hunger signalisiert? Das Intervallfasten, insbesondere die 16:8 Methode, gibt Ihrem Körper die Chance auf Autophagie.",
                    "Autophagie ist ein körpereigener Prozess, bei dem beschädigte Zellstrukturen abgebaut und recycelt werden. Das schützt vor Krankheiten.",
                    "Wichtig für Sie: In der Fastenphase ist nur Wasser, ungesüßter Tee oder schwarzer Kaffee erlaubt.",
                    "Starten Sie langsam: Schieben Sie Ihr Frühstück jeden Tag eine Stunde weiter nach hinten."
                ] 
            },
            { id: 3, title: "Digital Detox & Ihr Cortisolspiegel", cat: "Mental Health", time: "15 min", date: "08. Okt", author: "M. Psych. Bauer", image: "https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?auto=format&fit=crop&w=800", desc: "Wie die ständige Erreichbarkeit Ihr Gehirn in einen Alarmzustand versetzt.", fullText: ["Jede Push-Benachrichtigung löst einen Dopamin-Stoß und einen Anstieg von Cortisol aus..."] },
            { id: 4, title: "Herzgesundheit: Vorsorge neu gedacht", cat: "Prävention", time: "11 min", date: "05. Okt", author: "Prof. Dr. Lang", image: "https://images.unsplash.com/photo-1505751172876-fa1923c5c528?auto=format&fit=crop&w=800", desc: "Warum moderne Diagnostik weit über einfaches Cholesterin hinausgeht.", fullText: ["Moderne Marker wie Lipoprotein(a) geben Einblicke in Ihr individuelles Risiko..."] },
            { id: 5, title: "Toxikologische Belastung durch Rauchen", cat: "Prävention", time: "9 min", author: "Dr. Lisa Neubauer", image: "https://cdn.prod.www.spiegel.de/images/caa850d5-0001-0004-0000-000001220757_w1200_r1_fpx41.97_fpy50.jpg", desc: "Warum auch gelegentlicher Konsum Ihre DNA schädigt.", fullText: ["Jede Zigarette führt dem Körper über 4.000 Chemikalien zu..."] },
            { id: 6, title: "Finanzieller Stress & Resilienz", cat: "Mental Health", time: "14 min", author: "Dr. Wagner", image: "https://images.unsplash.com/photo-1554224155-1696413565d3?auto=format&fit=crop&w=800", desc: "Wie ökonomische Sorgen Ihre Gesundheit beeinflussen.", fullText: ["Finanzielle Sorgen wirken wie ein permanenter Stressor auf das Nervensystem..."] }
        ];

        const PERSONALIZED_CONTENT = [
            { 
                id: 101, title: "Ihr individuelles Stoffwechsel-Profil", cat: "Analyse", time: "Jetzt", author: "VitalCore AI", match: "99% Match",
                image: "https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?auto=format&fit=crop&w=800", 
                fullText: ["Anhand Ihrer biometrischen Daten haben wir Ihren präzisen basalen Ruheumsatz kalkuliert..."] 
            },
            { id: 102, title: "Ihre biometrische Lebensplanung & Prognose", cat: "Zukunfts-Report", time: "14 min", author: "Prof. Dr. Leisner", match: "84% Match", image: "https://images.unsplash.com/photo-1559757175-5700dde675bc?auto=format&fit=crop&w=800", fullText: ["Dieser Report basiert auf biostatistischer Modellierung Ihrer Angaben..."] },
            { id: 103, title: "Wirtschaftsstatus & Gesundheitsrisiko", cat: "Sozio-Analyse", time: "Jetzt", author: "VitalCore Finance", match: "93% Match", image: "https://images.unsplash.com/photo-1450101499163-c8848c66ca85?auto=format&fit=crop&w=800", fullText: ["Wir nutzen Daten zu Einkommen und Schulden, um Ihre allostatische Last zu berechnen..."] },
            { id: 104, title: "Körperbild & Optimierungswünsche", cat: "Psychosomatik", time: "Jetzt", author: "Dr. Stein", match: "95% Match", image: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?auto=format&fit=crop&w=800", fullText: ["Wir analysieren die Body-Mind-Gap basierend auf Ihren Optimierungswünschen..."] }
        ];

        // 4. HELFER-KOMPONENTEN (GEGEN CURSOR-BUG NACH DRAUSSEN VERSCHOBEN)
        const NoAnswer = ({ field, noAnswers, setNoAnswers }) => (
            <label className="flex items-center gap-2 mt-2 cursor-pointer w-fit group">
                <input type="checkbox" checked={!!noAnswers[field]} onChange={() => setNoAnswers(prev => ({ ...prev, [field]: !prev[field] }))} className="w-3.5 h-3.5 rounded border-slate-300 text-blue-600 focus:ring-blue-500" />
                <span className="text-[9px] text-slate-400 group-hover:text-slate-600 uppercase tracking-widest font-bold transition-colors">Keine Angabe</span>
            </label>
        );

        const JaNeinInput = ({ label, field, placeholder, formData, setFormData, noAnswers, setNoAnswers, interact }) => {
            return (
                <div className={noAnswers[field] ? 'opacity-30' : ''}>
                    <label className="text-sm font-bold text-slate-700 block mb-3">{label}</label>
                    <div className="flex gap-4 mb-3">
                        {['ja', 'nein'].map(opt => (
                            <button key={opt} type="button" disabled={noAnswers[field]} onClick={() => { interact(); setFormData(prev => ({...prev, [field]: opt})); }} className={`px-6 py-2 rounded-full text-xs font-black border-2 transition-all ${formData[field] === opt ? 'bg-slate-900 border-slate-900 text-white' : 'bg-transparent border-slate-200 text-slate-400'}`}>
                                {opt.toUpperCase()}
                            </button>
                        ))}
                    </div>
                    {formData[field] === 'ja' && !noAnswers[field] && (
                        <textarea 
                            name={`${field}Details`} 
                            value={formData[`${field}Details`] || ''} 
                            onChange={(e) => { interact(); setFormData(prev => ({...prev, [e.target.name]: e.target.value})); }} 
                            placeholder={placeholder} 
                            className="w-full p-4 bg-slate-50 border border-slate-100 rounded-2xl text-xs outline-none focus:bg-white h-20 animate-fade-in" 
                        />
                    )}
                    <NoAnswer field={field} noAnswers={noAnswers} setNoAnswers={setNoAnswers} />
                </div>
            );
        };

        const RealisticEye = ({ color, className, hasLashes }) => {
            const gradId = React.useId().replace(/:/g, ""); 
            return (
                <svg viewBox="0 0 100 70" className={className} preserveAspectRatio="xMidYMid meet" style={{ overflow: 'visible' }}>
                    <defs>
                        <radialGradient id={`irisGrad-${gradId}`}><stop offset="20%" stopColor="#111" /><stop offset="40%" stopColor={color} /><stop offset="100%" stopColor="#000" /></radialGradient>
                    </defs>
                    <g className="animate-blink-1">
                        <path d="M5,35 Q50,-12 95,35 Q50,82 5,35 Z" fill="white" stroke="#4b5563" strokeWidth="0.5" />
                        <circle cx="50" cy="35" r="17" fill={`url(#irisGrad-${gradId})`} />
                        <circle cx="50" cy="35" r="8" fill="black" />
                    </g>
                </svg>
            );
        };

        const StimulusOverlay = ({ config, variant = "banner" }) => {
            if (!config || !config.eyes) return null;
            const eyeColor = variant === 'banner' ? '#3b82f6' : '#5D4037';
            const pos = variant === 'form' ? 'fixed top-4 left-1/2 -translate-x-1/2' : 'absolute -top-12 left-1/2 -translate-x-1/2'; 
            return (
                <div className={`pointer-events-none z-[100] flex gap-4 p-2 bg-white rounded-full shadow-xl border ${pos}`}>
                    <RealisticEye color={eyeColor} className="w-20 h-14" hasLashes={true} />
                    <RealisticEye color={eyeColor} className="w-20 h-14" hasLashes={true} />
                </div>
            );
        };

        const CookieBanner = ({ group, onDecision, audioObject }) => {
            const config = getGroupConfig(group);
            const [details, setDetails] = useState(false);
            useEffect(() => { if (config.sound && audioObject) audioObject.play().catch(()=>{}); }, []);
            return (
                <div className="fixed bottom-0 left-0 right-0 z-50 p-4 md:p-8 bg-white shadow-[0_-20px_50px_rgba(0,0,0,0.15)] border-t-4 border-blue-600 animate-slide-up rounded-t-[40px]">
                    <div className="max-w-7xl mx-auto relative pt-8">
                        <StimulusOverlay config={config} variant="banner" />
                        <div className="flex flex-col lg:flex-row gap-8 items-center">
                            <div className="flex-1">
                                <h3 className="text-xl font-black mb-2">Privatsphäre-Einstellungen</h3>
                                <p className="text-sm text-slate-500 max-w-2xl">Wir nutzen Cookies für Ihr Nutzererlebnis.</p>
                                <button onClick={() => setDetails(!details)} className="text-xs text-blue-600 font-bold uppercase mt-2">{details ? "− Weniger" : "+ Mehr"}</button>
                            </div>
                            <div className={`lg:w-1/3 p-5 rounded-[24px] border-2 ${config.info ? 'bg-red-50 border-red-100' : 'bg-blue-50 border-blue-100'}`}>
                                <div className={`flex items-center gap-2 font-black mb-1 uppercase tracking-tighter text-xs ${config.info ? 'text-red-600' : 'text-blue-600'}`}>
                                    <Icon path={config.info ? paths.shield : paths.activity} className="w-4 h-4"/> 
                                    {config.info ? 'HINWEIS ZUR DATENERFASSUNG' : 'WILLKOMMEN BEI VITALCORE'}
                                </div>
                                <p className={`text-[10px] leading-relaxed ${config.info ? 'text-red-800/80' : 'text-blue-800/80'}`}>
                                    {config.info 
                                        ? "Alles, was Sie auf dieser Seite tun oder eingeben, wird lückenlos aufgezeichnet. Einmal erfasst, bleiben diese Informationen dauerhaft gespeichert."
                                        : "VitalCore bietet Ihnen eine moderne Plattform für fundiertes medizinisches Wissen. Wir laden Sie ein, die Bereiche unseres Portals zu erkunden."
                                    }
                                </p>
                            </div>
                            <div className="flex flex-col gap-3 shrink-0">
                                <button onClick={() => onDecision('accept_all')} className="px-8 py-4 bg-blue-600 text-white font-black rounded-2xl uppercase text-sm">Alle akzeptieren</button>
                                <button onClick={() => onDecision('reject_all')} className="px-8 py-3 bg-white text-slate-400 border rounded-2xl text-xs uppercase">Nur Notwendige</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const BlogPage = ({ onAction, mode = 'initial', cookieChoice }) => {
            const [selectedArticle, setSelectedArticle] = useState(null);
            const [categoryFilter, setCategoryFilter] = useState("Alle Beiträge");
            const [showLoginModal, setShowLoginModal] = useState(false);
            const [likes, setLikes] = useState({});
            const [articlesToDisplay, setArticlesToDisplay] = useState([]);
            const requiredTime = mode === 'initial' ? MIN_BROWSING_TIME_1 : MIN_BROWSING_TIME_2;
            const [timeLeft, setTimeLeft] = useState(requiredTime);

            useEffect(() => {
                if (mode === 'initial') setArticlesToDisplay(BLOG_CONTENT);
                else setArticlesToDisplay([...PERSONALIZED_CONTENT, ...BLOG_CONTENT]);
            }, [mode]);

            useEffect(() => {
                if (timeLeft <= 0) return;
                const timer = setInterval(() => setTimeLeft(t => t - 1), 1000);
                return () => clearInterval(timer);
            }, [timeLeft]);

            const filteredArticles = categoryFilter === "Alle Beiträge" ? articlesToDisplay : articlesToDisplay.filter(a => a.cat === categoryFilter);

            const ActionButton = ({inHeader}) => {
                if (timeLeft > 0) return <button disabled className="bg-slate-200 text-slate-400 rounded-full px-5 py-2 text-sm">{timeLeft}s</button>;
                if (mode === 'initial' && cookieChoice === null) return <button disabled className="bg-orange-100 text-orange-600 rounded-full px-5 py-2 text-sm font-bold">Cookie-Wahl treffen</button>;
                return <button onClick={onAction} className="bg-slate-900 text-white rounded-full px-6 py-2 text-sm font-bold shadow-lg animate-fade-in">{mode === 'initial' ? 'Profil erstellen' : 'Weiter'}</button>;
            };

            if (selectedArticle) {
                return (
                    <div className="min-h-screen bg-white flex flex-col animate-fade-in">
                        <nav className="border-b px-4 h-16 flex items-center justify-between sticky top-0 bg-white z-20 shadow-sm">
                            <div className="font-bold text-xl cursor-pointer" onClick={() => setSelectedArticle(null)}>Vital<span className="text-green-600">Core</span></div>
                            <div className="flex gap-4 items-center">
                                <button onClick={() => setSelectedArticle(null)} className="text-sm font-medium text-slate-500 flex items-center gap-1"><Icon path={paths.arrowLeft} className="w-4 h-4" /> Zurück</button>
                                <ActionButton inHeader={true} />
                            </div>
                        </nav>
                        <article className="max-w-3xl mx-auto px-4 py-12">
                            <img src={selectedArticle.image} className="w-full h-80 rounded-2xl object-cover mb-8 shadow-md" />
                            <h1 className="text-4xl font-extrabold mb-4">{selectedArticle.title}</h1>
                            <div className="flex items-center gap-3 text-slate-500 mb-8 border-b pb-8">
                                <span className="font-bold text-green-600 uppercase">{selectedArticle.cat}</span>
                                <span>•</span>
                                <span className="font-medium">{selectedArticle.author}</span>
                                <span>•</span>
                                <span className="flex items-center gap-1"><Icon path={paths.clock} className="w-4 h-4" /> {selectedArticle.time} Lesezeit</span>
                            </div>
                            <div className="prose prose-lg text-slate-700 leading-relaxed space-y-6">
                                {selectedArticle.fullText.map((p, i) => <p key={i}>{p}</p>)}
                            </div>
                        </article>
                    </div>
                );
            }

            return (
                <div className="min-h-screen flex flex-col bg-slate-50 relative">
                    <nav className="bg-white border-b px-4 h-16 flex items-center justify-between sticky top-0 z-20 shadow-sm">
                        <div className="font-bold text-xl">VitalCore {mode === 'personalized' && <span className="ml-2 text-xs bg-green-600 text-white px-2 py-0.5 rounded uppercase font-bold tracking-widest">Für Sie</span>}</div>
                        <div className="hidden md:flex gap-1">
                            {["Alle Beiträge", "Forschung", "Ernährung", "Mental Health", "Prävention"].map(cat => (
                                <button key={cat} onClick={() => setCategoryFilter(cat)} className={`px-4 py-2 rounded-full text-xs font-medium transition-all ${categoryFilter === cat ? 'bg-slate-900 text-white shadow-md' : 'text-slate-500 hover:bg-slate-100'}`}>{cat}</button>
                            ))}
                        </div>
                        <div className="flex gap-4 items-center">
                            <button className="p-2 text-slate-400 hover:text-slate-600" onClick={() => setShowLoginModal(true)}><Icon path={paths.search} className="w-5 h-5" /></button>
                            <ActionButton inHeader={true} />
                        </div>
                    </nav>
                    <main className="max-w-6xl mx-auto px-4 py-8 w-full">
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {filteredArticles.map(art => (
                                <article key={art.id} onClick={() => setSelectedArticle(art)} className="bg-white rounded-2xl border shadow-sm hover:shadow-lg transition-all cursor-pointer overflow-hidden flex flex-col h-full relative group">
                                    {art.match && <div className="absolute top-3 left-3 z-10 bg-green-500 text-white text-[10px] font-bold px-2 py-1 rounded shadow-lg">{art.match}</div>}
                                    <div className="h-48 overflow-hidden relative">
                                        <img src={art.image} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />
                                        <div className="absolute top-3 right-3">
                                            <button onClick={(e) => { e.stopPropagation(); setLikes({...likes, [art.id]: !likes[art.id]}); }} className={`p-2 rounded-full backdrop-blur-md ${likes[art.id] ? 'bg-red-50 text-red-500' : 'bg-black/30 text-white'}`}>
                                                <Icon path={likes[art.id] ? paths.heartFilled : paths.heart} className="w-5 h-5" />
                                            </button>
                                        </div>
                                    </div>
                                    <div className="p-5 flex-1 flex flex-col">
                                        <div className="text-[10px] font-black text-green-600 uppercase mb-2">{art.cat}</div>
                                        <h3 className="text-lg font-bold text-slate-900 mb-2 leading-tight group-hover:text-green-600 transition-colors">{art.title}</h3>
                                        <p className="text-slate-600 text-sm mb-4 flex-1 line-clamp-3 leading-relaxed">{art.desc}</p>
                                        <div className="flex items-center justify-between pt-4 border-t border-slate-100">
                                            <span className="text-xs font-bold text-slate-500 uppercase">{art.author}</span>
                                            <span className="text-[10px] text-slate-400 font-medium">{art.time}</span>
                                        </div>
                                    </div>
                                </article>
                            ))}
                        </div>
                    </main>
                    {showLoginModal && (
                        <div className="fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 animate-fade-in" onClick={() => setShowLoginModal(false)}>
                            <div className="bg-white rounded-2xl p-8 max-w-sm w-full text-center shadow-2xl" onClick={(e) => e.stopPropagation()}>
                                <div className="w-12 h-12 bg-red-100 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4"><Icon path={paths.shield} className="w-6 h-6" /></div>
                                <h3 className="text-xl font-bold mb-2">Zugriff verweigert</h3>
                                <p className="text-slate-600 mb-6 text-sm">Dieser Bereich ist für registrierte Teilnehmer reserviert.</p>
                                <button onClick={() => setShowLoginModal(false)} className="w-full bg-slate-900 text-white font-bold py-3 rounded-xl hover:bg-slate-800 transition-colors">Verstanden</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const RegistrationForm = ({ onSubmit, group, audioObject }) => {
            const [formData, setFormData] = useState({ 
                age: '', gender: '', height: '', weight: '', insurance: '', dietStyle: [], dietHistory: '', tobacco: '', tobaccoDetails: '', alcohol: '', alcoholDetails: '', drugs: '', drugsDetails: '', sportFreq: '', sportType: '', bodySatisfaction: 5, bodyChangeGoals: '', bodyChangeDetails: '', mentalHealth: '', mentalHealthDetails: '', sexOrientation: '', reproduction: '', stis: '', stisDetails: '', income: '', debts: '', debtsDetails: ''
            });
            const [noAnswers, setNoAnswers] = useState({});
            const [interactionStarted, setInteractionStarted] = useState(false);
            const [timeLeft, setTimeLeft] = useState(MIN_REGISTRATION_TIME);
            const config = getGroupConfig(group);
            
            useEffect(() => { const timer = setInterval(() => setTimeLeft(t => t > 0 ? t - 1 : 0), 1000); return () => clearInterval(timer); }, []);

            const interact = () => { if (!interactionStarted) { setInteractionStarted(true); if (config.sound && audioObject) audioObject.play().catch(()=>{}); } };

            const isFormComplete = () => {
                const req = ['age', 'gender', 'height', 'weight', 'insurance', 'dietStyle', 'dietHistory', 'sportFreq', 'tobacco', 'alcohol', 'drugs', 'bodySatisfaction', 'bodyChangeGoals', 'mentalHealth', 'sexOrientation', 'reproduction', 'stis', 'income', 'debts'];
                return req.every(f => noAnswers[f] || (formData[f] !== '' && formData[f] !== undefined && (Array.isArray(formData[f]) ? formData[f].length > 0 : true)));
            };

            return (
                <div className="min-h-screen bg-slate-100 py-12 px-4 relative pt-40 text-slate-900">
                    <StimulusOverlay config={config} variant="form" />
                    <div className="fixed top-[155px] left-1/2 -translate-x-1/2 w-[95%] max-w-xl z-[50] animate-fade-in pointer-events-none">
                        <div className={`backdrop-blur-sm border-2 p-4 rounded-[24px] shadow-xl ${config.info ? 'bg-red-50/95 border-red-200' : 'bg-blue-50/95 border-blue-200'}`}>
                            <div className={`flex items-center gap-2 font-black mb-1 uppercase tracking-tighter text-[10px] ${config.info ? 'text-red-600' : 'text-blue-600'}`}>
                                <Icon path={config.info ? paths.shield : paths.activity} className="w-4 h-4"/> 
                                {config.info ? 'HINWEIS ZUR DATENERFASSUNG' : 'WILLKOMMEN BEI VITALCORE'}
                            </div>
                            <p className={`text-[9px] leading-relaxed ${config.info ? 'text-red-800/90' : 'text-blue-800/90'}`}>
                                {config.info 
                                    ? "Alles, was Sie auf dieser Seite tun oder eingeben, wird lückenlos aufgezeichnet. Ihre Informationen werden sofort ausgewertet, um ein persönliches Bild Ihrer Person und Ihres Privatlebens zu erstellen. Einmal erfasst, bleiben diese Informationen dauerhaft gespeichert."
                                    : "VitalCore bietet Ihnen eine moderne Plattform für fundiertes medizinisches Wissen und individuelle Gesundheitsanalysen. Wir laden Sie ein, die verschiedenen Bereiche unseres Portals zu erkunden und unsere Funktionen zu nutzen, um Ihre persönlichen Ziele für mehr Wohlbefinden und Vitalität im Alltag zu erreichen."
                                }
                            </p>
                        </div>
                    </div>

                    <div className="max-w-2xl mx-auto bg-white shadow-2xl rounded-[40px] overflow-hidden border border-slate-200 relative z-10">
                        <header className="bg-slate-900 p-10 text-white text-center">
                            <h2 className="text-lg font-light tracking-widest uppercase leading-tight">Systembiologisches Gesundheitsprofil</h2>
                            <span className="text-[10px] text-blue-400 font-bold uppercase mt-2 block tracking-widest">Clinical Data Access</span>
                        </header>
                        <form onSubmit={(e) => {e.preventDefault(); if(isFormComplete()) onSubmit(formData);}} className="p-8 md:p-12 space-y-16">
                            
                            <section className="space-y-8">
                                <h3 className="text-[11px] font-black uppercase text-blue-600 border-b pb-2 tracking-widest">Modul 01: Biometrie</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div><label className="text-sm font-bold block mb-2">Alter</label><input type="text" name="age" value={formData.age} onChange={(e) => setFormData({...formData, age: e.target.value})} className="w-full py-2 border-b outline-none bg-transparent" /><NoAnswer field="age" noAnswers={noAnswers} setNoAnswers={setNoAnswers} /></div>
                                    <div><label className="text-sm font-bold block mb-2">Geschlecht</label><select name="gender" value={formData.gender} onChange={(e) => setFormData({...formData, gender: e.target.value})} className="w-full py-2 border-b outline-none bg-transparent"><option value="">Wählen...</option><option value="m">Männlich</option><option value="w">Weiblich</option></select><NoAnswer field="gender" noAnswers={noAnswers} setNoAnswers={setNoAnswers} /></div>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div><label className="text-sm font-bold block mb-2">Größe (cm)</label><input type="text" name="height" value={formData.height} onChange={(e) => setFormData({...formData, height: e.target.value})} className="w-full py-2 border-b outline-none bg-transparent" /><NoAnswer field="height" noAnswers={noAnswers} setNoAnswers={setNoAnswers} /></div>
                                    <div><label className="text-sm font-bold block mb-2">Gewicht (kg)</label><input type="text" name="weight" value={formData.weight} onChange={(e) => setFormData({...formData, weight: e.target.value})} className="w-full py-2 border-b outline-none bg-transparent" /><NoAnswer field="weight" noAnswers={noAnswers} setNoAnswers={setNoAnswers} /></div>
                                </div>
                                <div><label className="text-sm font-bold block mb-2">Versicherungsstatus</label><select name="insurance" value={formData.insurance} onChange={(e) => setFormData({...formData, insurance: e.target.value})} className="w-full py-2 border-b outline-none bg-transparent"><option value="">Wählen...</option><option value="gkv">Gesetzlich</option><option value="pkv">Privat</option><option value="andere">Andere</option></select><NoAnswer field="insurance" noAnswers={noAnswers} setNoAnswers={setNoAnswers} /></div>
                            </section>

                            <section className="space-y-8">
                                <h3 className="text-[11px] font-black uppercase text-blue-600 border-b pb-2 tracking-widest">Modul 02: Stoffwechsel</h3>
                                <div>
                                    <label className="text-sm font-bold block mb-4">Aktuelle Ernährungsform(en)</label>
                                    <div className="flex flex-wrap gap-2">
                                        {['Omnivor', 'Vegetarisch', 'Vegan', 'Keto', 'Fasten', 'Intervall'].map(diet => (
                                            <button key={diet} type="button" onClick={() => { interact(); const next = formData.dietStyle.includes(diet) ? formData.dietStyle.filter(d => d !== diet) : [...formData.dietStyle, diet]; setFormData({...formData, dietStyle: next}); }} className={`px-4 py-2 rounded-full text-xs font-bold border-2 transition-all ${formData.dietStyle.includes(diet) ? 'bg-blue-600 border-blue-600 text-white shadow-md' : 'border-slate-200 text-slate-400'}`}>{diet}</button>
                                        ))}
                                    </div>
                                    <NoAnswer field="dietStyle" noAnswers={noAnswers} setNoAnswers={setNoAnswers} />
                                </div>
                                <div><label className="text-sm font-bold block mb-2">Vergangene Diäten?</label><textarea name="dietHistory" value={formData.dietHistory} onChange={(e) => setFormData({...formData, dietHistory: e.target.value})} placeholder="z.B. Saftkuren, Low-Carb..." className="w-full p-4 bg-slate-50 border rounded-xl h-20 outline-none" /><NoAnswer field="dietHistory" noAnswers={noAnswers} setNoAnswers={setNoAnswers} /></div>
                            </section>

                            <section className="space-y-12">
                                <h3 className="text-[11px] font-black uppercase text-blue-600 border-b pb-2 tracking-widest">Modul 03-04: Lebensstil & Toxikologie</h3>
                                <div>
                                    <label className="text-sm font-bold block mb-2">Sportfrequenz</label>
                                    <select name="sportFreq" value={formData.sportFreq} onChange={(e) => setFormData({...formData, sportFreq: e.target.value})} className="w-full py-2 border-b outline-none bg-transparent text-sm"><option value="">Wählen...</option><option value="täglich">Täglich</option><option value="oft">2-4 mal pro Woche</option><option value="nie">Seltener / Nie</option></select>
                                    {formData.sportFreq !== 'nie' && formData.sportFreq !== '' && !noAnswers.sportFreq && (
                                        <div className="mt-4"><label className="text-[10px] font-bold text-slate-400 uppercase block mb-2">Welche Sportarten?</label><input type="text" name="sportType" value={formData.sportType} onChange={(e) => setFormData({...formData, sportType: e.target.value})} className="w-full py-2 border-b outline-none bg-transparent" /></div>
                                    )}
                                    <NoAnswer field="sportFreq" noAnswers={noAnswers} setNoAnswers={setNoAnswers} />
                                </div>
                                <JaNeinInput label="Nutzen Sie Tabakprodukte?" field="tobacco" placeholder="Welche Produkte und wie oft?" formData={formData} setFormData={setFormData} noAnswers={noAnswers} setNoAnswers={setNoAnswers} interact={interact} />
                                <JaNeinInput label="Trinken Sie regelmäßig Alkohol?" field="alcohol" placeholder="Welche Getränke und wie viel?" formData={formData} setFormData={setFormData} noAnswers={noAnswers} setNoAnswers={setNoAnswers} interact={interact} />
                                <JaNeinInput label="Nutzen Sie illegale Substanzen?" field="drugs" placeholder="Welche Substanzen und wie häufig?" formData={formData} setFormData={setFormData} noAnswers={noAnswers} setNoAnswers={setNoAnswers} interact={interact} />
                            </section>

                            <section className="space-y-12">
                                <h3 className="text-[11px] font-black uppercase text-blue-600 border-b pb-2 tracking-widest">Modul 05: Psychosomatik</h3>
                                <div><label className="text-sm font-bold block mb-1">Körperzufriedenheit (1-10)</label><input type="range" name="bodySatisfaction" min="1" max="10" value={formData.bodySatisfaction} onChange={(e) => setFormData({...formData, bodySatisfaction: e.target.value})} className="w-full accent-blue-600" /><NoAnswer field="bodySatisfaction" noAnswers={noAnswers} setNoAnswers={setNoAnswers} /></div>
                                <JaNeinInput label="Gibt es operative Optimierungswünsche?" field="bodyChangeGoals" placeholder="Welche Eingriffe ziehen Sie in Erwägung?" formData={formData} setFormData={setFormData} noAnswers={noAnswers} setNoAnswers={setNoAnswers} interact={interact} />
                                <JaNeinInput label="Bestehen psychische Vorbelastungen?" field="mentalHealth" placeholder="Diagnosen oder Behandlungen?" formData={formData} setFormData={setFormData} noAnswers={noAnswers} setNoAnswers={setNoAnswers} interact={interact} />
                            </section>

                            <section className="space-y-12">
                                <h3 className="text-[11px] font-black uppercase text-blue-600 border-b pb-2 tracking-widest">Modul 06: Reproduktion</h3>
                                <div><label className="text-sm font-bold block mb-2">Sexuelle Orientierung</label><select name="sexOrientation" value={formData.sexOrientation} onChange={(e) => setFormData({...formData, sexOrientation: e.target.value})} className="w-full py-2 border-b outline-none bg-transparent text-sm"><option value="">Wählen...</option><option value="hetero">Hetero</option><option value="homo">Homo</option><option value="bi">Bi</option><option value="andere">Andere</option></select><NoAnswer field="sexOrientation" noAnswers={noAnswers} setNoAnswers={setNoAnswers} /></div>
                                <div><label className="text-sm font-bold block mb-2">Aktueller Kinderwunsch?</label><select name="reproduction" value={formData.reproduction} onChange={(e) => setFormData({...formData, reproduction: e.target.value})} className="w-full py-2 border-b outline-none bg-transparent text-sm"><option value="">Wählen...</option><option value="ja">Ja</option><option value="nein">Nein</option></select><NoAnswer field="reproduction" noAnswers={noAnswers} setNoAnswers={setNoAnswers} /></div>
                                <JaNeinInput label="Bekannte Geschlechtskrankheiten?" field="stis" placeholder="Historie der Infektionen..." formData={formData} setFormData={setFormData} noAnswers={noAnswers} setNoAnswers={setNoAnswers} interact={interact} />
                            </section>

                            <section className="space-y-12">
                                <h3 className="text-[11px] font-black uppercase text-blue-600 border-b pb-2 tracking-widest">Modul 07: Sozio-Ökonomie</h3>
                                <div><label className="text-sm font-bold block mb-2">Monatliches Netto-Einkommen</label><select name="income" value={formData.income} onChange={(e) => setFormData({...formData, income: e.target.value})} className="w-full py-2 border-b outline-none bg-transparent text-sm"><option value="">Wählen...</option><option value="1">Bis 1.500 €</option><option value="2">1.500-3.500 €</option><option value="4">Über 5.000 €</option></select><NoAnswer field="income" noAnswers={noAnswers} setNoAnswers={setNoAnswers} /></div>
                                <JaNeinInput label="Bestehen finanzielle Schulden?" field="debts" placeholder="Art oder Höhe der Schulden?" formData={formData} setFormData={setFormData} noAnswers={noAnswers} setNoAnswers={setNoAnswers} interact={interact} />
                            </section>

                            <button type="submit" disabled={timeLeft > 0 || !isFormComplete()} className={`w-full py-6 font-black text-xs uppercase tracking-[0.5em] rounded-3xl transition-all ${timeLeft > 0 || !isFormComplete() ? 'bg-slate-100 text-slate-300' : 'bg-blue-600 text-white hover:bg-blue-700 shadow-2xl active:scale-[0.98]'}`}>
                                {!isFormComplete() ? 'UNVOLLSTÄNDIG' : (timeLeft > 0 ? `VALIDIERUNG (${timeLeft}S)` : 'PROFIL FINALISIEREN')}
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        const LoadingScreen = ({ onFinished }) => {
            useEffect(() => { const t = setTimeout(onFinished, 3000); return () => clearTimeout(t); }, []);
            return (<div className="min-h-screen bg-slate-900 flex flex-col items-center justify-center p-4 text-white"><div className="w-20 h-20 border-4 border-blue-500 border-t-transparent rounded-full animate-spin-slow mb-8"></div><h2 className="text-2xl font-bold mb-2">Algorithmus analysiert Profil...</h2></div>);
        };

        const EndScreen = ({ data, sessionToken }) => {
            const [url, setUrl] = useState("");
            useEffect(() => { 
                const g = data.groupID; 
                setUrl(SOSCI_BASE_URL + "?i=" + sessionToken + "&IV02_01=" + g + "&g=" + g + "&mydata=" + encodeURIComponent(JSON.stringify(data))); 
            }, []);
            return (
                <div className="min-h-screen bg-slate-900 flex flex-col items-center justify-center p-4 text-center">
                    <div className="bg-white p-10 md:p-16 rounded-[40px] shadow-2xl max-w-lg w-full border-t-[12px] border-green-500 animate-fade-in text-slate-800">
                        <h2 className="text-2xl font-black mb-6">Teilnahme abgeschlossen!</h2>
                        <p className="text-lg text-slate-600 mb-10 leading-relaxed">Bitte klicken Sie auf den Button, um die Sitzung zu beenden.</p>
                        <a href={url} className="block w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-5 rounded-2xl shadow-xl no-underline text-xl">Fragebogen beenden</a>
                    </div>
                </div>
            );
        };

        const getGroupConfig = (groupID) => {
            const map = { 1: { eyes: false, sound: false, info: false }, 2: { eyes: true, sound: false, info: false }, 3: { eyes: false, sound: true, info: false }, 4: { eyes: true, sound: true, info: false }, 5: { eyes: true, sound: false, info: true }, 6: { eyes: false, sound: true, info: true }, 7: { eyes: true, sound: true, info: true } };
            return map[groupID] || map[1]; 
        };

        function App() {
            const [step, setStep] = useState('intro');
            const [cookieChoice, setCookieChoice] = useState(null);
            const [bannerVisible, setBannerVisible] = useState(false);
            const [groupID, setGroupID] = useState(1);
            const [finalData, setFinalData] = useState({});
            const [sessionToken, setSessionToken] = useState(null);
            const audioRef = useRef(null);
            const audioManRef = useRef(null);

            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                setGroupID(parseInt(params.get('g')) || 1);
                setSessionToken(params.get('t') || "guest");
                audioRef.current = new Audio('sound.mp3'); audioRef.current.volume = 0.5;
                audioManRef.current = new Audio('soundmann.mp3'); audioManRef.current.volume = 0.5;
            }, []);

            return (
                <div className="font-sans antialiased">
                    {step === 'intro' && <IntroScreen onStart={() => { setStep('blog'); setTimeout(() => setBannerVisible(true), COOKIE_BANNER_DELAY_MS); }} />}
                    {step === 'blog' && (
                        <>
                            <BlogPage mode="initial" cookieChoice={cookieChoice} onAction={() => setStep('register')} />
                            {bannerVisible && <CookieBanner group={groupID} onDecision={(d) => {setCookieChoice(d); setBannerVisible(false);}} audioObject={audioRef.current} />}
                        </>
                    )}
                    {step === 'register' && <RegistrationForm group={groupID} onSubmit={(d) => {setFinalData({...d, groupID, cookieChoice}); setStep('loading');}} audioObject={audioManRef.current} />}
                    {step === 'loading' && <LoadingScreen onFinished={() => setStep('personalized')} />}
                    {step === 'personalized' && <BlogPage mode="personalized" cookieChoice={cookieChoice} onAction={() => setStep('end')} />}
                    {step === 'end' && <EndScreen data={finalData} sessionToken={sessionToken} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

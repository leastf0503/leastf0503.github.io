<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VitalCore - Ihr Gesundheitsportal</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @keyframes slide-up { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        @keyframes pulse-slow { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        /* Blinzel-Effekt: 0% bis 90% offen, dann kurzes Schließen bei 95% */
/* Schnelleres Blinzeln: Dauer auf 2.5s reduziert */
@keyframes blink {
  0%, 88%, 100% { transform: scaleY(1); }
  92% { transform: scaleY(0.05); } /* Sehr schnelles "Zuklappen" */
}

.animate-blink-1 {
  animation: blink 3s infinite;
  transform-origin: 50% 50%; /* WICHTIG: Blinzeln von der Mitte aus */
}

.animate-blink-2 {
  animation: blink 3s infinite;
  animation-delay: 0.3s;
  transform-origin: 50% 50%;
}

/* Erstes Auge */
.animate-blink-1 {
  animation: blink 2.5s infinite;
  transform-origin: center;
}

/* Zweites Auge mit Verzögerung für mehr Realismus */
.animate-blink-2 {
  animation: blink 2.5s infinite;
  animation-delay: 0.4s; /* Das zweite Auge blinzelt kurz nach dem ersten */
  transform-origin: center;
}

.animate-blink {
  animation: blink 4s infinite;
  transform-origin: center;
}
        
        .animate-slide-up { animation: slide-up 0.5s ease-out forwards; }
        .animate-fade-in { animation: fade-in 0.8s ease-out forwards; }
        .animate-pulse-slow { animation: pulse-slow 3s infinite; }
        .animate-spin-slow { animation: spin 3s linear infinite; }
        
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8fafc; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        #error-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; padding: 20px; background: #fee2e2; border-bottom: 2px solid #ef4444; color: #991b1b; z-index: 9999; font-family: monospace; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>

    <div id="error-overlay">
        <strong>Systemfehler:</strong> <span id="error-msg">Unbekannter Fehler</span>
    </div>
    <script>
        window.onerror = function(msg, url, line, col, error) {
            document.getElementById('error-overlay').style.display = 'block';
            document.getElementById('error-msg').innerText = msg + " (Zeile: " + line + ")";
            return false;
        };
    </script>

    <div id="root"></div>

    <script type="text/babel">
        // ==========================================
        // 1. KONFIGURATION
        // ==========================================
        const MIN_BROWSING_TIME_1 = 5; 
        const MIN_REGISTRATION_TIME = 10; 
        const MIN_BROWSING_TIME_2 = 15; 
        const COOKIE_BANNER_DELAY_MS = 3000; 
        const SOSCI_BASE_URL = "https://www.soscisurvey.de/BA25LeaPaula/";

        const { useState, useEffect, useRef } = React;

        // ==========================================
        // 2. ICONS & ASSETS
        // ==========================================
        const Icon = ({ path, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{path}</svg>
        );

        const RealisticEye = ({ color, className, hasLashes }) => {
    // Einzigartige ID für die Gradients, damit sie sich nicht überschneiden
    const gradId = React.useId().replace(/:/g, ""); 
    
    return (
        <svg viewBox="0 0 100 70" className={className} preserveAspectRatio="xMidYMid meet" style={{ overflow: 'visible' }}>
            <defs>
                {/* Verlauf für den Augapfel (Sclera) - macht ihn rundlich */}
                <radialGradient id={`whiteGrad-${gradId}`} cx="50%" cy="50%" r="50%" fx="50%" fy="30%">
                    <stop offset="0%" stopColor="#ffffff" />
                    <stop offset="80%" stopColor="#ffffff" />
                    <stop offset="100%" stopColor="#d1d5db" />
                </radialGradient>
                
                {/* Verlauf für die Iris - gibt ihr Tiefe und Struktur */}
                <radialGradient id={`irisGrad-${gradId}`}>
                    <stop offset="20%" stopColor="#111" />
                    <stop offset="40%" stopColor={color} />
                    <stop offset="100%" stopColor="#000" stopOpacity="0.8" />
                </radialGradient>
            </defs>

            <g className="animate-blink-1">
                {/* Wimpern (optional) */}
                {hasLashes && (
                    <g stroke="#1a1a1a" strokeWidth="1.2" fill="none" strokeLinecap="round" opacity="0.8">
                        <path d="M15,28 Q10,15 5,12" /><path d="M25,23 Q20,10 15,8" /><path d="M35,20 Q32,8 28,5" />
                        <path d="M50,18 Q50,8 50,4" /><path d="M65,20 Q68,8 72,5" /><path d="M75,23 Q80,10 85,8" /><path d="M85,28 Q90,15 95,12" />
                    </g>
                )}

                {/* Augapfel mit Schatten am Rand */}
                <path d="M5,35 Q50,-12 95,35 Q50,82 5,35 Z" fill={`url(#whiteGrad-${gradId})`} stroke="#4b5563" strokeWidth="0.5" />
                
                {/* Iris mit Farbverlauf */}
                <circle cx="50" cy="35" r="17" fill={`url(#irisGrad-${gradId})`} />
                
                {/* Subtile Linien in der Iris (Striae) */}
                {[...Array(12)].map((_, i) => (
                    <line 
                        key={i} 
                        x1="50" y1="35" x2={50 + 15 * Math.cos(i * 30 * Math.PI/180)} y2={35 + 15 * Math.sin(i * 30 * Math.PI/180)} 
                        stroke="rgba(255,255,255,0.1)" strokeWidth="0.5" 
                    />
                ))}

                {/* Pupille */}
                <circle cx="50" cy="35" r="8" fill="#000" />
                
                {/* Lichtreflexe (Glanzpunkte) - Das Wichtigste für Realismus! */}
                <circle cx="45" cy="30" r="3.5" fill="#fff" opacity="0.8" />
                <circle cx="56" cy="40" r="1.5" fill="#fff" opacity="0.4" />
            </g>
        </svg>
    );
};
        
        const paths = {
            shield: <React.Fragment><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="M12 8v4"/><path d="M12 16h.01"/></React.Fragment>,
            check: <React.Fragment><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></React.Fragment>,
            user: <React.Fragment><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></React.Fragment>,
            search: <React.Fragment><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></React.Fragment>,
            arrowRight: <path d="M5 12h14m-7-7 7 7-7 7"/>,
            arrowLeft: <path d="M19 12H5m7 7-7-7 7-7"/>,
            leaf: <path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z" />,
            clock: <circle cx="12" cy="12" r="10"/>,
            activity: <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>,
            apple: <React.Fragment><path d="M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z"/><path d="M10 2c1 .5 2 2 2 5"/></React.Fragment>,
            coffee: <React.Fragment><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="4"/><line x1="10" x2="10" y1="2" y2="4"/><line x1="14" x2="14" y1="2" y2="4"/></React.Fragment>,
            heart: <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>,
            heartFilled: <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" fill="currentColor" stroke="none"/>,
            star: <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />,
            ciagrette: <React.Fragment><path d="M18 8c0-2.5-2-2.5-2-5"/><path d="M22 8c0-2.5-2-2.5-2-5"/><rect x="2" y="13" width="20" height="6" rx="2"/><path d="M22 16h-4"/><path d="M2 16h4"/></React.Fragment>,
            menu: <path d="M3 12h18M3 6h18M3 18h18" />,
            x: <path d="M18 6 6 18M6 6l12 12" />
        };

        // ==========================================
        // 3. DATEN: STANDARD & PERSONALISIERT
        // ==========================================
        const BLOG_CONTENT = [
    { 
        id: 1, 
        title: "Die 5 Säulen Ihrer Langlebigkeit", 
        cat: "Forschung", 
        time: "12 min", 
        date: "Aktuell", 
        author: "Dr. med. Weber", 
        image: "https://images.unsplash.com/photo-1476480862126-209bfaa8edc8?auto=format&fit=crop&w=800&q=80", 
        color: "bg-blue-100", 
        icon: paths.activity, 
        desc: "Erfahren Sie, wie kleine Anpassungen in Ihrer täglichen Routine Ihr biologisches Alter messbar senken können.", 
        fullText: [
            "Die moderne Altersforschung hat in den letzten Jahren bahnbrechende Erkenntnisse geliefert: Ihr biologisches Alter ist kein feststehender Wert, sondern das Resultat Ihrer täglichen Entscheidungen.",
            "Die erste Säule bildet die Ernährung. Es geht hierbei weniger um strikten Verzicht, sondern um die Qualität der Nährstoffe. Komplexe Kohlenhydrate und hochwertige Fette schützen Ihre Zellmembranen vor oxidativem Stress.",
            "Zweitens spielt die moderate Bewegung eine Rolle. Sie müssen kein Leistungssportler sein, um Ihre Gefäße elastisch zu halten. Schon 30 Minuten zügiges Gehen täglich aktiviert Ihre Mitochondrien.",
            "Die dritte Säule ist die Schlafhygiene. Während Sie schlafen, führt Ihr Gehirn eine Art Selbstreinigung durch. Ohne diese nächtliche Regeneration steigen die Entzündungswerte in Ihrem Körper massiv an.",
            "Viertens: Stressmanagement. Chronisch hohes Cortisol schwächt Ihr Immunsystem. Wir zeigen Ihnen Techniken, wie Sie Ihren Vagusnerv gezielt stimulieren können.",
            "Fünftens: Soziale Resonanz. Statistiken belegen, dass Menschen in stabilen sozialen Gefügen deutlich seltener an chronischen Krankheiten leiden.",
            "Zusammenfassend lässt sich sagen: Langlebigkeit ist die Summe Ihrer Gewohnheiten."
        ] 
    },
    { 
        id: 2, 
        title: "Intervallfasten 16:8 für Einsteiger", 
        cat: "Ernährung", 
        time: "10 min", 
        date: "10. Okt", 
        author: "Sarah Klein", 
        image: "https://images.unsplash.com/photo-1498837167922-ddd27525d352?auto=format&fit=crop&w=800", 
        color: "bg-orange-100", 
        icon: paths.apple, 
        desc: "Warum zeitlich begrenzte Esspausen für Ihren Stoffwechsel wertvoller sind als jede klassische Kalorien-Diät.", 
        fullText: [
            "Haben Sie sich schon einmal gefragt, warum Ihr Körper ständig Hunger signalisiert? In unserer modernen Gesellschaft ist Ihr Verdauungssystem permanent im Einsatz.",
            "Das Intervallfasten, insbesondere die 16:8 Methode, setzt genau hier an. Indem Sie 16 Stunden fasten und in einem 8-Stunden-Fenster essen, geben Sie Ihrem Körper die Chance auf Autophagie.",
            "Autophagie ist ein körpereigener Prozess, bei dem beschädigte Zellstrukturen abgebaut und recycelt werden. Das schützt Sie vor neurodegenerativen Erkrankungen und stärkt Ihre Stoffwechselrate.",
            "Wichtig für Sie: In der Fastenphase ist nur Wasser, ungesüßter Tee oder schwarzer Kaffee erlaubt. Jede Kalorienzufuhr würde den Insulinspiegel heben und den Regenerationsprozess sofort stoppen.",
            "Starten Sie langsam: Schieben Sie Ihr Frühstück jeden Tag eine Stunde weiter nach hinten, bis Sie das 16-Stunden-Fenster bequem erreichen."
        ] 
    },
    { 
        id: 3, 
        title: "Digital Detox & Ihr Cortisolspiegel", 
        cat: "Mental Health", 
        time: "15 min", 
        date: "08. Okt", 
        author: "M. Psych. Bauer", 
        image: "https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?auto=format&fit=crop&w=800&q=80", 
        color: "bg-purple-100", 
        icon: paths.coffee, 
        desc: "Wie die ständige Erreichbarkeit Ihr Gehirn in einen Alarmzustand versetzt und was Sie dagegen tun können.", 
        fullText: [
            "Ihr Smartphone ist heute Ihr ständiger Begleiter, doch der Preis für diese Vernetzung ist hoch. Jede Push-Benachrichtigung löst in Ihrem Gehirn einen kleinen Dopamin-Stoß aus, gefolgt von einem Anstieg des Stresshormons Cortisol.",
            "Chronisch erhöhte Cortisolwerte beeinträchtigen Ihre Konzentrationsfähigkeit und führen langfristig zu Schlafstörungen und Erschöpfungszuständen.",
            "Digital Detox bedeutet nicht, dass Sie Ihre Technik aufgeben müssen. Es geht um einen bewussten Umgang. Reservieren Sie sich Zeitfenster, in denen Sie offline sind – insbesondere in den ersten 60 Minuten nach dem Aufstehen.",
            "Indem Sie Ihr Schlafzimmer zur handyfreien Zone erklären, erlauben Sie Ihrem Nervensystem, wirklich zur Ruhe zu kommen. Sie werden bemerken, wie sich Ihre Schlafqualität bereits nach wenigen Tagen verbessert."
        ] 
    },
    { 
        id: 4, 
        title: "Herzgesundheit: Vorsorge neu gedacht", 
        cat: "Prävention", 
        time: "11 min", 
        date: "05. Okt", 
        author: "Prof. Dr. Lang", 
        image: "https://images.unsplash.com/photo-1505751172876-fa1923c5c528?auto=format&fit=crop&w=800", 
        color: "bg-red-100", 
        icon: paths.heart, 
        desc: "Kennen Sie Ihre Blutwerte? Warum moderne Diagnostik weit über einfaches Cholesterin hinausgeht.", 
        fullText: [
            "Herz-Kreislauf-Erkrankungen sind nach wie vor die häufigste Todesursache, doch viele Risiken ließen sich durch präzise Vorsorge minimieren.",
            "Moderne klinische Marker wie das Lipoprotein(a) oder das hochsensitive CRP geben uns heute Einblicke in Ihr individuelles Risiko, die früher unmöglich waren.",
            "Ein besonderes Augenmerk liegt auf stillen Entzündungen in Ihren Gefäßwänden. Diese werden durch Fehlernährung, Bewegungsmangel, aber auch durch unbehandelten Stress begünstigt.",
            "Wir empfehlen Ihnen, einmal jährlich ein erweitertes Blutbild anfertigen zu lassen. Wer seine Zahlen kennt, kann gezielt gegensteuern, bevor Symptome auftreten."
        ] 
    },
    { 
        id: 5, 
        title: "Toxikologische Belastung durch Rauchen", 
        cat: "Prävention", 
        time: "9 min", 
        author: "Dr. Lisa Neubauer", 
        image: "https://cdn.prod.www.spiegel.de/images/caa850d5-0001-0004-0000-000001220757_w1200_r1_fpx41.97_fpy50.jpg", 
        color: "bg-orange-100", 
        icon: paths.ciagrette, 
        desc: "Warum auch gelegentlicher Konsum Ihre DNA schädigt und wie Ihr Körper regenerieren kann.", 
        fullText: [
            "Tabakkonsum ist die größte vermeidbare Gesundheitsgefahr unserer Zeit. Jede Zigarette führt Ihrem Körper über 4.000 Chemikalien zu, von denen viele direkt Ihre DNA angreifen.",
            "Besonders kritisch ist die Belastung für Ihre Lungenbläschen und Ihr Herz-Kreislauf-System. Die Gefäße verengen sich unmittelbar, was den Blutdruck steigen lässt und die Sauerstoffversorgung Ihrer Organe verschlechtert.",
            "Die gute Nachricht für Sie: Ihr Körper besitzt enorme Selbstheilungskräfte. Schon 24 Stunden nach der letzten Zigarette sinkt Ihr Risiko für einen Herzinfarkt deutlich.",
            "Nach einem Jahr ohne Tabak hat sich Ihr Risiko für koronare Herzkrankheiten bereits halbiert. Es ist nie zu spät, diesen Regenerationsprozess einzuleiten."
        ] 
    },
    { 
        id: 6, 
        title: "Finanzieller Stress & Körperliche Resilienz", 
        cat: "Mental Health", 
        time: "14 min", 
        author: "Dr. Wagner", 
        image: "https://images.unsplash.com/photo-1554224155-1696413565d3?auto=format&fit=crop&w=800", 
        color: "bg-slate-100", 
        icon: paths.search, 
        desc: "Wie ökonomische Sorgen Ihre Gesundheit beeinflussen und wie Sie Ihre psychische Widerstandskraft stärken.", 
        fullText: [
            "Es ist klinisch erwiesen: Finanzielle Sorgen und Schuldenlast wirken wie ein permanenter Stressor auf Ihr vegetatives Nervensystem. Ihr Körper befindet sich in einer dauerhaften 'Flucht-oder-Kampf'-Reaktion.",
            "Dies führt nicht nur zu psychischer Erschöpfung, sondern manifestiert sich oft in Verspannungen, Verdauungsproblemen oder chronischen Kopfschmerzen.",
            "Um Ihre Resilienz zu stärken, ist es wichtig, diese Zusammenhänge zu erkennen. Gesundheit ist ein ganzheitliches Konzept, das auch Ihre sozio-ökonomische Stabilität umfasst.",
            "Suchen Sie aktiv nach Wegen, diesen Stress zu reduzieren – sei es durch professionelle Beratung oder gezielte Entspannungstechniken, die Ihren Parasympathikus aktivieren."
        ] 
    }
];
        const PERSONALIZED_CONTENT = [
    { 
        id: 101, 
        title: "Ihr individuelles Stoffwechsel-Profil", 
        cat: "Analyse", 
        time: "Jetzt", 
        author: "VitalCore AI", 
        image: "https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?auto=format&fit=crop&w=800", 
        color: "bg-green-100", 
        icon: paths.check, 
        desc: "Basierend auf Ihren Angaben zu Biometrie und Ernährung haben wir Ihre metabolische Rate berechnet.", 
        fullText: [
            "Anhand der von Ihnen übermittelten Daten (Alter, Größe, Gewicht) hat unser System einen spezifischen Grundumsatz für Sie ermittelt.",
            "Ihre Angaben zur aktuellen Ernährungsform (z.B. Mischkost oder vegetarisch) wurden mit Ihrem Aktivitätslevel abgeglichen. Ihr Körper weist eine moderate metabolische Flexibilität auf.",
            "Da Sie Informationen zu Ihren Vorerkrankungen und Medikamenten bereitgestellt haben, konnten wir deren Einfluss auf Ihren Insulinspiegel in diese Analyse einbeziehen. Wir empfehlen Ihnen, die Zufuhr von Proteinen leicht zu erhöhen, um Ihre Muskelmasse basierend auf Ihrem Alter zu schützen.",
            "Detaillierte Handlungsanweisungen finden Sie in Ihrem persönlichen Download-Bereich."
        ], 
        match: "99% Match" 
    },
    { 
        id: 102, 
        title: "Sexuelle Gesundheit & Prävention", 
        cat: "Intim-Report", 
        time: "Vertraulich", 
        author: "Medical Team", 
        image: "https://images.unsplash.com/photo-1516541196182-6bdb0516ed27?auto=format&fit=crop&w=800", 
        color: "bg-purple-100", 
        icon: paths.shield, 
        desc: "Ihre Angaben zu Partneranzahl und STI-Historie wurden für dieses Profil ausgewertet.", 
        fullText: [
            "Dieser vertrauliche Report basiert auf Ihren sensiblen Angaben zur Anzahl Ihrer Sexualpartner in den letzten 12 Monaten und Ihrem Umgang mit Verhütungsmitteln.",
            "Da Sie Informationen über ungeschützten Geschlechtsverkehr bereitgestellt haben, berechnet unser System ein spezifisches Risiko-Profil für sexuell übertragbare Infektionen (STIs). Basierend auf Ihrer Historie empfehlen wir ein klinisches Screening im Abstand von 6 Monaten.",
            "Ihre Angaben zu früheren Infektionen wurden berücksichtigt, um langfristige Folgen für Ihre reproduktive Gesundheit auszuschließen. Diese Daten unterliegen strengster Geheimhaltung und dienen ausschließlich Ihrer persönlichen Vorsorgeplanung."
        ], 
        match: "97% Match" 
    },
    { 
        id: 103, 
        title: "Wirtschaftsstatus & Gesundheitsrisiko", 
        cat: "Sozio-Analyse", 
        time: "Jetzt", 
        author: "VitalCore Finance", 
        image: "https://images.unsplash.com/photo-1450101499163-c8848c66ca85?auto=format&fit=crop&w=800", 
        color: "bg-slate-100", 
        icon: paths.shield, 
        desc: "Die Analyse Ihres Einkommens und Ihrer Schuldenlast in Bezug auf Ihr Stresslevel.", 
        fullText: [
            "Sie haben detaillierte Angaben zu Ihrem monatlichen Netto-Einkommen und Ihrer aktuellen Schuldensituation gemacht. Diese Faktoren haben einen direkten Einfluss auf Ihre psychische Belastungsgrenze.",
            "Unser Algorithmus hat Ihren wirtschaftlichen Stress-Status als relevant für Ihre allgemeine Gesundheit eingestuft. Ein hohes Maß an finanzieller Unsicherheit korreliert in Ihrem Profil mit einem erhöhten Risiko für psychosomatische Beschwerden.",
            "Hinsichtlich Ihres Versicherungsstatus (GKV/PKV) haben wir geprüft, welche der empfohlenen Präventionsmaßnahmen von Ihrem Kostenträger übernommen werden, um Ihre finanzielle Situation nicht zusätzlich zu belasten."
        ], 
        match: "93% Match" 
    },
    { 
        id: 104, 
        title: "Körperbild & Optimierungswünsche", 
        cat: "Psychosomatik", 
        time: "Jetzt", 
        author: "Dr. Stein", 
        image: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?auto=format&fit=crop&w=800", 
        color: "bg-blue-100", 
        icon: paths.user, 
        desc: "Auswertung Ihrer Ziele zur körperlichen Veränderung und operativen Optimierung.", 
        fullText: [
            "In Ihrem Gesundheitsprofil haben Sie spezifische Aspekte Ihres Körpers benannt, die Sie gerne operativ oder therapeutisch verändern möchten. Wir haben diese Wünsche mit Ihrem aktuellen Zufriedenheitswert (Skala 1-10) abgeglichen.",
            "Basierend auf diesen Daten schlagen wir Ihnen in diesem Modul Fachärzte und Behandlungsmethoden vor, die exakt auf Ihre beschriebenen Problemzonen zugeschnitten sind.",
            "Bitte beachten Sie: Da Sie auch Angaben zu psychischen Vorbelastungen gemacht haben, empfehlen wir vor jedem invasiven Eingriff ein klärendes Gespräch, um sicherzustellen, dass die angestrebte Veränderung zu einer echten Steigerung Ihrer Lebensqualität führt."
        ], 
        match: "95% Match" 
    }
];

        // ==========================================
        // 4. HELFER FUNKTIONEN
        // ==========================================
        const getGroupConfig = (groupID) => {
            const map = {
                0: { eyes: false, sound: false, info: false },
                1: { eyes: true,  sound: false, info: false },
                2: { eyes: false, sound: true,  info: false },
                3: { eyes: true,  sound: true,  info: false },
                5: { eyes: true,  sound: false, info: true  },
                6: { eyes: false, sound: true,  info: true  },
                7: { eyes: true,  sound: true,  info: true  },
            };
            return map[groupID] || map[0];
        };

        const playSoundFile = (audioObj) => {
            if (!audioObj) return;
            audioObj.currentTime = 0;
            const playPromise = audioObj.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => console.log("Audio Error:", error));
            }
        };

        // ==========================================
        // 5. KOMPONENTEN
        // ==========================================

        const IntroScreen = ({ onStart }) => (
            <div className="min-h-screen bg-slate-900 flex items-center justify-center p-4">
                <div className="bg-white max-w-md w-full p-8 rounded-2xl shadow-2xl text-center animate-fade-in">
                    <div className="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-6">
                        <Icon path={paths.activity} className="w-8 h-8" />
                    </div>
                    <h1 className="text-2xl font-bold text-gray-900 mb-4">Willkommen</h1>
                    <p className="text-gray-600 mb-8">
                        Bitte stellen Sie sicher, dass Ihr Ton eingeschaltet ist.<br/>
                        Klicken Sie auf "Starten", um die Webseite zu laden.
                    </p>
                    <div className="text-xs text-gray-300 mt-2 mb-6">
                        System-Check: {window.location.search.includes('t=') ? "✅ Token erkannt" : "❌ Kein Token gefunden"}
                    </div>
                    <button onClick={onStart} className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg transition-transform transform active:scale-95 text-lg">
                        Starten
                    </button>
                </div>
            </div>
        );

        // --- STIMULUS OVERLAY ---
        const StimulusOverlay = ({ config, variant = "banner" }) => {
            const eyeColor = variant === 'banner' ? '#3b82f6' : '#5D4037';
            const positionClass = variant === 'form' 
                ? 'fixed top-0 left-1/2 -translate-x-1/2 pt-2' 
                : 'absolute -top-16 left-1/2 -translate-x-1/2'; 

            return (
                <div className={`pointer-events-none z-[60] flex flex-col items-center gap-2 transition-opacity duration-500 ${positionClass}`}>
                    {config.eyes && (
                        <div className="flex gap-4 items-center justify-center filter drop-shadow-lg">
                            <div className="bg-white p-2 rounded-full border-2 border-gray-300 shadow-2xl overflow-hidden animate-pulse-slow">
                                <RealisticEye color={eyeColor} className="w-24 h-16" hasLashes={variant === 'form'} />
                            </div>
                            <div className="bg-white p-2 rounded-full border-2 border-gray-300 shadow-2xl overflow-hidden animate-pulse-slow">
                                <RealisticEye color={eyeColor} className="w-24 h-16" hasLashes={variant === 'form'} />
                            </div>
                        </div>
                    )}
                    {config.info && variant === 'form' && (
                        <div className="bg-red-50 border-2 border-red-200 p-4 rounded-xl text-red-900 shadow-2xl mt-2 max-w-md text-center animate-fade-in backdrop-blur-sm bg-opacity-95">
                            <div className="flex items-center justify-center gap-2 font-bold mb-2 text-red-700 uppercase tracking-wide text-sm">
                                <Icon path={paths.shield} className="w-5 h-5"/> Datenschutz-Hinweis
                            </div>
                            <p className="text-xs leading-relaxed font-medium">
                                Achtung: Wenn Sie zustimmen, können Ihre persönlichen Informationen an Dritte weitergegeben und für Werbung genutzt werden. Dies kann Risiken für die Sicherheit Ihrer Daten bergen.
                            </p>
                        </div>
                    )}
                </div>
            );
        };

        const CookieBanner = ({ group, onDecision, audioObject, onBannerLoad }) => {
            const config = getGroupConfig(group);
            useEffect(() => { onBannerLoad(); if (config.sound && audioObject) playSoundFile(audioObject); }, []);
            const [details, setDetails] = useState(false);

            return (
                <div className="fixed bottom-0 left-0 right-0 z-50 p-4 md:p-6 bg-white shadow-[0_-10px_40px_rgba(0,0,0,0.2)] border-t-4 border-blue-600 animate-slide-up">
                    <div className="max-w-6xl mx-auto relative">
                        <StimulusOverlay config={config} variant="banner" />
                        <div className="flex flex-col md:flex-row gap-6 items-center">
                            <div className="flex-1">
                                <h3 className="text-lg font-bold text-gray-900 mb-2">Privatsphäre-Einstellungen</h3>
                                <p className="text-sm text-gray-600 leading-relaxed mb-3">Wir nutzen Cookies und Tracking-Technologien, um Ihr Nutzererlebnis zu personalisieren und Marketingmaßnahmen zu verbessern. {details && <span className="block mt-2 text-gray-500">Dabei werden Daten an Dritte übertragen, auch außerhalb der EU. Dies kann Risiken für die Sicherheit Ihrer Daten bergen.</span>}</p>
                                <button onClick={() => setDetails(!details)} className="text-xs text-blue-600 underline font-medium hover:text-blue-800">{details ? "Weniger Details" : "Mehr Informationen"}</button>
                            </div>
                            {config.info && (<div className="w-full md:w-72 shrink-0 animate-fade-in"><div className="bg-red-50 border-2 border-red-200 p-3 rounded-lg text-xs text-red-900 shadow-sm"><div className="flex items-center gap-2 font-bold mb-1 text-red-700 uppercase tracking-wide"><Icon path={paths.shield} className="w-4 h-4"/> Datenschutz-Hinweis</div>Achtung: Wenn Sie zustimmen, können Ihre persönlichen Informationen an Dritte weitergegeben und für Werbung genutzt werden.</div></div>)}
                            <div className="flex flex-col gap-3 w-full md:w-auto shrink-0">
                                <button onClick={() => onDecision('accept_all')} className="px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded shadow-md text-sm transition-transform active:scale-95">Alle akzeptieren</button>
                                <button onClick={() => onDecision('reject_all')} className="px-8 py-3 bg-white hover:bg-gray-100 text-gray-700 font-medium border border-gray-300 rounded shadow-sm text-sm transition-colors">Nur Notwendige</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- BLOG PAGE (Handle logic for both Initial and Personalized) ---
// 1. Hier 'cookieChoice' als Parameter hinzufügen!
// --- BLOG PAGE (Handle logic for both Initial and Personalized) ---
// --- BLOG PAGE (Handle logic for both Initial and Personalized) ---
const BlogPage = ({ onAction, mode = 'initial', cookieChoice }) => {
    const [selectedArticle, setSelectedArticle] = useState(null);
    const [categoryFilter, setCategoryFilter] = useState("Alle Beiträge");
    const [showLoginModal, setShowLoginModal] = useState(false);
    const [likes, setLikes] = useState({});
    const [articlesToDisplay, setArticlesToDisplay] = useState([]);

    // Zeit-Logik
    const requiredTime = mode === 'initial' ? MIN_BROWSING_TIME_1 : MIN_BROWSING_TIME_2;
    const [timeLeft, setTimeLeft] = useState(requiredTime);

    useEffect(() => {
        if (mode === 'initial') {
            setArticlesToDisplay(BLOG_CONTENT);
        } else {
            const oldContentShuffled = [...BLOG_CONTENT].sort(() => 0.5 - Math.random());
            setArticlesToDisplay([...PERSONALIZED_CONTENT, ...oldContentShuffled]);
        }
    }, [mode]);

    useEffect(() => {
        if (timeLeft <= 0) return;
        const timer = setInterval(() => setTimeLeft(prev => prev - 1), 1000);
        return () => clearInterval(timer);
    }, [timeLeft]);

    const filteredArticles = categoryFilter === "Alle Beiträge" 
        ? articlesToDisplay 
        : articlesToDisplay.filter(a => a.cat === categoryFilter);

    const categories = ["Alle Beiträge", "Forschung", "Ernährung", "Fitness", "Mental Health", "Prävention"];
    const toggleLike = (e, id) => { e.stopPropagation(); setLikes(prev => ({...prev, [id]: !prev[id]})); };

    // Hilfskomponente für den Titel
    const HeaderTitle = () => (
        <div onClick={() => {setCategoryFilter("Alle Beiträge"); setSelectedArticle(null);}} className="flex items-center gap-2 cursor-pointer hover:opacity-80 transition-opacity">
            <div className="p-1.5 bg-green-100 rounded text-green-600"><Icon path={paths.leaf} className="w-6 h-6" /></div>
            <span className="text-xl font-bold tracking-tight text-slate-800">
                Vital<span className="text-green-600">Core</span>
                {mode === 'personalized' && <span className="ml-2 text-xs bg-green-600 text-white px-2 py-0.5 rounded uppercase">Für Sie</span>}
            </span>
        </div>
    );

    // Hilfskomponente für den Button (mit Cookie-Zwang)
    const ActionButton = ({inHeader}) => {
        if (mode === 'initial') {
            // 1. Timer läuft noch
            if (timeLeft > 0) {
                return (
                    <button disabled className={`bg-slate-300 text-slate-500 rounded-full font-medium cursor-not-allowed flex items-center gap-2 ${inHeader ? 'px-5 py-2 text-sm' : 'w-full py-3 justify-center'}`}>
                        <Icon path={paths.clock} className="w-4 h-4 animate-pulse" /> Gesundheitsprofil erstellen in {timeLeft}s
                    </button>
                );
            }
            // 2. Timer fertig, aber keine Cookies gewählt
            if (cookieChoice === null) {
                return (
                    <button disabled className={`bg-orange-100 text-orange-600 border border-orange-200 rounded-full font-bold cursor-not-allowed flex items-center gap-2 ${inHeader ? 'px-5 py-2 text-sm' : 'w-full py-3 justify-center'}`}>
                        Bitte treffen Sie eine Cookie-Wahl
                    </button>
                );
            }
            // 3. Alles bereit
            return (
                <button onClick={onAction} className={`bg-slate-900 text-white rounded-full font-medium hover:bg-slate-800 transition-colors shadow-lg shadow-slate-900/20 animate-fade-in ${inHeader ? 'px-5 py-2 text-sm' : 'w-full py-3'}`}>
                    Gesundheitsprofil erstellen
                </button>
            );
        } else {
            // Personalized Mode
            if (timeLeft > 0) return (<div className={`bg-green-100 text-green-800 rounded-full text-xs font-bold animate-pulse ${inHeader ? 'px-4 py-2' : 'w-full py-3 text-center'}`}>Personalisierte Ansicht aktiv...</div>);
            return (
                <button onClick={onAction} className={`bg-green-600 text-white rounded-full font-bold hover:bg-green-700 transition-colors shadow-lg shadow-green-900/20 animate-fade-in ${inHeader ? 'px-6 py-2 text-sm' : 'w-full py-3'}`}>
                    Usability Test beendet! Zurück zum Fragebogen
                </button>
            );
        }
    };

    // Detailansicht eines Artikels
    if (selectedArticle) {
        const related = articlesToDisplay.filter(a => a.id !== selectedArticle.id).sort(() => 0.5 - Math.random()).slice(0, 3);
        return (
            <div className="min-h-screen flex flex-col font-sans text-slate-800 bg-white animate-fade-in">
                <nav className="bg-white border-b sticky top-0 z-20 shadow-sm">
                    <div className="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
                        <HeaderTitle />
                        <div className="flex gap-4 items-center">
                            <button onClick={() => setSelectedArticle(null)} className="text-sm font-medium text-slate-500 hover:text-green-600 flex items-center gap-1">
                                <Icon path={paths.arrowLeft} className="w-4 h-4" /> Zurück
                            </button>
                            <ActionButton inHeader={true} />
                        </div>
                    </div>
                </nav>
                <article className="max-w-3xl mx-auto px-4 py-12">
                    <div className="w-full h-80 rounded-2xl overflow-hidden mb-8 shadow-md">
                        <img src={selectedArticle.image} className="w-full h-full object-cover" />
                    </div>
                    <div className="flex items-center gap-3 text-sm font-bold text-green-600 uppercase tracking-wider mb-3">
                        {selectedArticle.cat} • {selectedArticle.date}
                    </div>
                    <h1 className="text-4xl font-extrabold text-slate-900 mb-6 leading-tight">{selectedArticle.title}</h1>
                    <div className="flex items-center gap-3 text-slate-500 mb-8 pb-8 border-b">
                        <span className="font-medium">{selectedArticle.author}</span>
                        <span>•</span>
                        <span className="flex items-center gap-1"><Icon path={paths.clock} className="w-4 h-4" /> {selectedArticle.time} Lesezeit</span>
                    </div>
                    <div className="prose prose-lg text-slate-700 leading-relaxed space-y-6">
                        {selectedArticle.fullText.map((p, i) => <p key={i}>{p}</p>)}
                    </div>
                    <div className="mt-16 pt-8 border-t text-center italic text-slate-500">
                        Dieser Beitrag wurde für Ihr persönliches Gesundheitsprofil zusammengestellt.
                    </div>
                </article>
            </div>
        );
    }

    // Hauptübersicht
    return (
        <div className="min-h-screen flex flex-col font-sans text-slate-800 bg-slate-50 relative">
            <nav className="bg-white border-b sticky top-0 z-20 shadow-sm">
                <div className="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
                    <HeaderTitle />
                    <div className="hidden md:flex gap-1 overflow-x-auto no-scrollbar mx-4">
                        {categories.map(item => (
                            <button key={item} onClick={() => setCategoryFilter(item)} className={`whitespace-nowrap px-3 py-2 text-sm font-medium rounded-full transition-colors ${categoryFilter === item ? 'bg-slate-900 text-white' : 'text-slate-500 hover:bg-slate-100'}`}>
                                {item}
                            </button>
                        ))}
                    </div>
                    <div className="flex gap-4 items-center shrink-0">
                        <button className="p-2 text-slate-400 hover:text-slate-600" onClick={() => setShowLoginModal(true)}>
                            <Icon path={paths.search} className="w-5 h-5" />
                        </button>
                        <ActionButton inHeader={true} />
                    </div>
                </div>
            </nav>

            <main className="flex-grow max-w-6xl mx-auto px-4 py-8 w-full">
                {mode === 'initial' && categoryFilter === 'Alle Beiträge' && (
                    <div className="bg-slate-900 rounded-3xl p-8 md:p-12 mb-12 text-white relative overflow-hidden flex flex-col md:flex-row items-center gap-8">
                        <div className="flex-1 relative z-10">
                            <span className="text-green-400 font-bold tracking-wider text-xs uppercase mb-2 block">Trending Topic</span>
                            <h2 className="text-3xl md:text-5xl font-extrabold mb-4 leading-tight">Wissenschaft trifft <br/><span className="text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-300">Lebensqualität</span></h2>
                            <p className="text-slate-300 mb-6 max-w-lg">Entdecken Sie fundierte Artikel zu Langlebigkeit, Ernährung und Ihrer mentalen Gesundheit.</p>
                        </div>
                        <div className="w-full md:w-1/3 aspect-square bg-gradient-to-br from-slate-800 to-slate-700 rounded-2xl border border-slate-600 p-6 flex items-center justify-center relative z-10">
                            <Icon path={paths.activity} className="w-20 h-20 text-green-500" />
                        </div>
                    </div>
                )}

                {mode === 'personalized' && categoryFilter === 'Alle Beiträge' && (
                    <div className="bg-green-50 rounded-3xl p-8 mb-12 border border-green-200 text-center animate-fade-in">
                        <h2 className="text-2xl font-bold text-green-900 mb-2">Willkommen zurück!</h2>
                        <p className="text-green-700">Wir haben Ihren Feed basierend auf Ihren Angaben für Sie personalisiert.</p>
                    </div>
                )}

                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {filteredArticles.map(art => (
                        <article key={art.id} onClick={() => setSelectedArticle(art)} className="bg-white rounded-2xl border border-slate-100 shadow-sm hover:shadow-lg transition-all cursor-pointer overflow-hidden group flex flex-col h-full relative">
                            {art.match && (
                                <div className="absolute top-3 left-3 z-10 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded shadow-lg animate-pulse-slow">
                                    {art.match}
                                </div>
                            )}
                            <div className="h-48 overflow-hidden relative">
                                <img src={art.image} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />
                                <div className="absolute top-3 right-3">
                                    <button onClick={(e) => toggleLike(e, art.id)} className={`p-2 rounded-full backdrop-blur-md transition-colors ${likes[art.id] ? 'bg-red-50 text-red-500' : 'bg-black/30 text-white hover:bg-black/50'}`}>
                                        <Icon path={likes[art.id] ? paths.heartFilled : paths.heart} className="w-5 h-5" />
                                    </button>
                                </div>
                                <div className="absolute bottom-3 left-3 bg-black/60 backdrop-blur-sm text-white text-xs px-2 py-1 rounded font-medium">{art.cat}</div>
                            </div>
                            <div className="p-5 flex-1 flex flex-col">
                                <h3 className="text-lg font-bold text-slate-900 mb-2 leading-tight group-hover:text-green-600 transition-colors">{art.title}</h3>
                                <p className="text-slate-600 text-sm line-clamp-3 mb-4 flex-1">{art.desc}</p>
                                <div className="flex items-center gap-2 pt-4 border-t border-slate-100">
                                    <span className="text-xs font-bold text-slate-500">{art.author}</span>
                                </div>
                            </div>
                        </article>
                    ))}
                </div>
            </main>

            {showLoginModal && (
                <div className="fixed inset-0 bg-black/50 z-[100] flex items-center justify-center p-4 animate-fade-in" onClick={() => setShowLoginModal(false)}>
                    <div className="bg-white rounded-xl shadow-2xl p-8 max-w-sm w-full text-center" onClick={(e) => e.stopPropagation()}>
                        <div className="w-12 h-12 bg-red-100 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <Icon path={paths.shield} className="w-6 h-6" />
                        </div>
                        <h3 className="text-xl font-bold text-gray-900 mb-2">Zugriff verweigert</h3>
                        <p className="text-gray-600 mb-6">Dieser Bereich ist ausschließlich für Teilnehmer der Studie reserviert. Bitte fahren Sie mit der Erstellung Ihres Gesundheitsprofils fort.</p>
                        <button onClick={() => setShowLoginModal(false)} className="w-full bg-gray-900 text-white font-bold py-2 rounded-lg">Verstanden</button>
                    </div>
                </div>
            )}
        </div>
    );
};

const RegistrationForm = ({ onSubmit, group, audioObject }) => {
    const [formData, setFormData] = useState({ 
        age: '', gender: '', height: '', weight: '', insurance: '',
        dietStyle: '', dietHistory: '',
        tobacco: '', tobaccoFreq: '',
        alcohol: '', alcoholFreq: '',
        drugs: '', drugsFreq: '',
        sportFreq: '', sportType: '',
        bodySatisfaction: 5, bodyChangeGoals: '',
        mentalHealth: '', medication: '',
        reproductiveHistory: '', sexDysfunction: '',
        sexOrientation: '', partners: '', stis: '', unprotectedSex: '',
        income: '', debts: ''
    });

    const [noAnswers, setNoAnswers] = useState({});
    const [interactionStarted, setInteractionStarted] = useState(false);
    const [timeLeft, setTimeLeft] = useState(MIN_REGISTRATION_TIME);
    
    useEffect(() => { 
        const timer = setInterval(() => setTimeLeft(t => t > 0 ? t - 1 : 0), 1000); 
        return () => clearInterval(timer); 
    }, []);

    const config = getGroupConfig(group);
    
    const interact = () => { 
        if (!interactionStarted) { 
            setInteractionStarted(true); 
            if (config.sound && audioObject) audioObject.play().catch(()=>{}); 
        } 
    };

    const handleChange = (e) => { 
        interact(); 
        const { name, value } = e.target;
        if (name === 'age' || name === 'height' || name === 'weight') {
            const val = value.replace(/[^0-9]/g, '');
            setFormData(prev => ({...prev, [name]: val}));
        } else {
            setFormData(prev => ({...prev, [name]: value})); 
        }
    };

    const handleNoAnswerToggle = (field) => { 
        interact(); 
        setNoAnswers(prev => ({ ...prev, [field]: !prev[field] }));
        // Wir setzen einen Wert, damit die Validierung erkennt, dass die Frage "beantwortet" wurde
        setFormData(prev => ({ ...prev, [field]: !noAnswers[field] ? 'keine_angabe' : '' }));
    };

    // Validierung: Alter unter 18 ist ungültig (außer es wurde "Keine Angabe" gewählt)
    const isAgeInvalid = !noAnswers.age && formData.age !== '' && formData.age !== 'keine_angabe' && parseInt(formData.age) < 18;

    // --- VERBESSERTE VALIDIERUNGSLOGIK FÜR JEDE EINZELNE FRAGE ---
    const isFormComplete = () => {
        const check = (f) => noAnswers[f] || (formData[f] !== '' && formData[f] !== undefined);
        
        return (
            check('age') && check('gender') && check('height') && check('weight') && check('insurance') &&
            check('dietStyle') && check('dietHistory') &&
            check('tobacco') && check('alcohol') && check('drugs') &&
            check('sportFreq') && check('sportType') &&
            check('bodySatisfaction') && check('bodyChangeGoals') &&
            check('mentalHealth') &&
            check('partners') && check('sexOrientation') && check('stis') && check('unprotectedSex') &&
            check('income') && check('debts') &&
            !isAgeInvalid
        );
    };

    const NoAnswer = ({ field }) => (
        <label className="flex items-center gap-2 mt-2 cursor-pointer w-fit group">
            <input 
                type="checkbox" 
                checked={!!noAnswers[field]} 
                onChange={() => handleNoAnswerToggle(field)} 
                className="w-3.5 h-3.5 rounded border-slate-300 text-blue-600 focus:ring-blue-500"
            />
            <span className="text-[9px] text-slate-400 group-hover:text-slate-600 uppercase tracking-widest font-bold transition-colors">Keine Angabe</span>
        </label>
    );

    const ClinicalDisclaimer = ({ text }) => (
        <div className="bg-slate-50 border-l-2 border-blue-200 p-3 mb-6 text-[10px] text-slate-500 italic leading-snug">
            <strong>Klinische Relevanz:</strong> {text}
        </div>
    );

    return (
        <div className="min-h-screen bg-slate-100 py-8 px-4 relative text-slate-900">
            {interactionStarted && <StimulusOverlay config={config} variant="form" />}
            
            <div className="max-w-2xl mx-auto bg-white shadow-2xl rounded-xl overflow-hidden border border-slate-200 relative z-10">
                <header className="bg-slate-900 p-8 text-white">
                    <div className="flex justify-between items-center">
                        <h2 className="text-lg font-light tracking-[0.2em] uppercase">Systembiologisches Gesundheitsprofil</h2>
                        <span className="text-[10px] bg-blue-600 px-2 py-1 rounded font-bold uppercase">Clinical Data Access</span>
                    </div>
                </header>

                <form onSubmit={(e) => {e.preventDefault(); if(isFormComplete()) onSubmit(formData);}} className="p-8 md:p-12 space-y-16">
                    
                    {/* MODUL 01: BIOMETRIE */}
                    <section>
                        <h3 className="text-[11px] font-black uppercase tracking-widest text-blue-600 mb-6 border-b pb-2">Modul 01: Biometrische Parameter</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div className={noAnswers.age ? 'opacity-30' : ''}>
                                <label className="text-sm font-bold text-slate-700 block mb-2">Wie alt sind Sie?</label>
                                <input type="text" name="age" disabled={noAnswers.age} placeholder="Jahre" value={noAnswers.age ? '' : formData.age} onChange={handleChange} onFocus={interact} className={`w-full py-2 outline-none border-b transition-all bg-transparent ${isAgeInvalid ? 'border-red-500 text-red-500' : 'border-slate-200 focus:border-blue-600'}`} />
                                {isAgeInvalid && <p className="text-[10px] text-red-500 mt-1 font-bold italic">Teilnahme erst ab 18 Jahren.</p>}
                                <NoAnswer field="age" />
                            </div>
                            <div className={noAnswers.gender ? 'opacity-30' : ''}>
                                <label className="text-sm font-bold text-slate-700 block mb-2">Welchem biologischen Geschlecht gehören Sie an?</label>
                                <select name="gender" disabled={noAnswers.gender} value={noAnswers.gender} onChange={handleChange} className="w-full py-2 outline-none border-b border-slate-200 bg-transparent">
                                    <option value="">Wählen...</option><option value="m">Männlich</option><option value="w">Weiblich</option><option value="d">Divers</option>
                                </select>
                                <NoAnswer field="gender" />
                            </div>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div className={noAnswers.height ? 'opacity-30' : ''}>
                                <label className="text-sm font-bold text-slate-700 block mb-2">Ihre Körpergröße (cm)?</label>
                                <input type="text" name="height" disabled={noAnswers.height} placeholder="cm" value={noAnswers.height ? '' : formData.height} onChange={handleChange} className="w-full py-2 outline-none border-b border-slate-200 focus:border-blue-600 bg-transparent" />
                                <NoAnswer field="height" />
                            </div>
                            <div className={noAnswers.weight ? 'opacity-30' : ''}>
                                <label className="text-sm font-bold text-slate-700 block mb-2">Ihr Körpergewicht (kg)?</label>
                                <input type="text" name="weight" disabled={noAnswers.weight} placeholder="kg" value={noAnswers.weight ? '' : formData.weight} onChange={handleChange} className="w-full py-2 outline-none border-b border-slate-200 focus:border-blue-600 bg-transparent" />
                                <NoAnswer field="weight" />
                            </div>
                        </div>
                        <div className={noAnswers.insurance ? 'opacity-30' : ''}>
                            <label className="text-sm font-bold text-slate-700 block mb-2">Wie sind Sie versichert?</label>
                            <select name="insurance" disabled={noAnswers.insurance} value={formData.insurance} onChange={handleChange} className="w-full py-2 outline-none border-b border-slate-200 bg-transparent">
                                <option value="">Wählen...</option><option value="gkv">Gesetzlich</option><option value="pkv">Privat</option><option value="andere">Sonstige</option>
                            </select>
                            <NoAnswer field="insurance" />
                        </div>
                    </section>

                    {/* MODUL 02: ERNÄHRUNG */}
                    <section>
                        <h3 className="text-[11px] font-black uppercase tracking-widest text-blue-600 mb-6 border-b pb-2">Modul 02: Metabolischer Lebensstil</h3>
                        <ClinicalDisclaimer text="Die Zufuhr von Makronährstoffen und Ihre Diät-Historie geben Aufschluss über Ihre metabolische Flexibilität." />
                        <div className="space-y-8">
                            <div className={noAnswers.dietStyle ? 'opacity-30' : ''}>
                                <label className="text-sm font-bold text-slate-700 block mb-2">Welche Ernährungsform praktizieren Sie aktuell?</label>
                                <select name="dietStyle" disabled={noAnswers.dietStyle} value={formData.dietStyle} onChange={handleChange} className="w-full py-2 outline-none border-b border-slate-200 bg-transparent">
                                    <option value="">Wählen...</option><option value="omnivor">Omnivor (Mischkost)</option><option value="veggie">Vegetarisch / Vegan</option><option value="keto">Low Carb / Keto</option><option value="fasten">Intervallfasten</option>
                                </select>
                                <NoAnswer field="dietStyle" />
                            </div>
                            <div className={noAnswers.dietHistory ? 'opacity-30' : ''}>
                                <label className="text-sm font-bold text-slate-700 block mb-2">Haben Sie in der Vergangenheit Diäten zur Gewichtsreduktion durchgeführt?</label>
                                <textarea name="dietHistory" disabled={noAnswers.dietHistory} value={noAnswers.dietHistory ? '' : formData.dietHistory} placeholder="z.B. Low-Fat, Saftkuren..." onChange={handleChange} className="w-full p-4 bg-slate-50 border border-slate-100 rounded-lg outline-none focus:bg-white h-20 transition-all"></textarea>
                                <NoAnswer field="dietHistory" />
                            </div>
                        </div>
                    </section>

                    {/* MODUL 03: SPORT */}
                    <section>
                        <h3 className="text-[11px] font-black uppercase tracking-widest text-blue-600 mb-6 border-b pb-2">Modul 03: Physische Aktivitätsrate</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div className={noAnswers.sportFreq ? 'opacity-30' : ''}>
                                <label className="text-sm font-bold text-slate-700 block mb-2">Häufigkeit sportlicher Betätigung?</label>
                                <select name="sportFreq" disabled={noAnswers.sportFreq} value={formData.sportFreq} onChange={handleChange} className="w-full py-2 outline-none border-b border-slate-200 bg-transparent">
                                    <option value="">Wählen...</option><option value="täglich">Täglich</option><option value="oft">2-4 mal pro Woche</option><option value="selten">1 mal pro Woche</option><option value="nie">Seltener / Nie</option>
                                </select>
                                <NoAnswer field="sportFreq" />
                            </div>
                            <div className={noAnswers.sportType ? 'opacity-30' : ''}>
                                <label className="text-sm font-bold text-slate-700 block mb-2">Welche Sportarten üben Sie aus?</label>
                                <input type="text" name="sportType" disabled={noAnswers.sportType} value={noAnswers.sportType ? '' : formData.sportType} placeholder="z.B. Krafttraining, Laufen..." onChange={handleChange} className="w-full py-2 outline-none border-b border-slate-200 bg-transparent" />
                                <NoAnswer field="sportType" />
                            </div>
                        </div>
                    </section>

                    {/* MODUL 04: TOXIKOLOGIE */}
                    <section className="space-y-10">
                        <h3 className="text-[11px] font-black uppercase tracking-widest text-blue-600 mb-6 border-b pb-2">Modul 04: Toxikologische Belastung</h3>
                        
                        <div className={noAnswers.tobacco ? 'opacity-30' : ''}>
                            <label className="text-sm font-bold text-slate-700 block mb-2">Konsumieren Sie Tabak- oder Nikotinprodukte (z.B. Zigaretten, Snus)?</label>
                            <input name="tobacco" disabled={noAnswers.tobacco} value={noAnswers.tobacco ? '' : formData.tobacco} placeholder="Welche Produkte und wie oft?" onChange={handleChange} className="w-full py-2 outline-none border-b border-slate-200 bg-transparent mb-2" />
                            <NoAnswer field="tobacco" />
                        </div>

                        <div className={noAnswers.alcohol ? 'opacity-30' : ''}>
                            <label className="text-sm font-bold text-slate-700 block mb-2">Konsumieren Sie regelmäßig alkoholische Getränke?</label>
                            <input name="alcohol" disabled={noAnswers.alcohol} value={noAnswers.alcohol ? '' : formData.alcohol} placeholder="Bevorzugte Getränke und Häufigkeit?" onChange={handleChange} className="w-full py-2 outline-none border-b border-slate-200 bg-transparent mb-2" />
                            <NoAnswer field="alcohol" />
                        </div>

                        <div className={noAnswers.drugs ? 'opacity-30' : ''}>
                            <label className="text-sm font-bold text-slate-700 block mb-2">Nutzen Sie illegale Substanzen (z.B. Cannabis, Kokain, MDMA)?</label>
                            <input name="drugs" disabled={noAnswers.drugs} value={noAnswers.drugs ? '' : formData.drugs} placeholder="Welche Substanzen wurden konsumiert?" onChange={handleChange} className="w-full py-2 outline-none border-b border-slate-200 bg-transparent mb-2" />
                            <NoAnswer field="drugs" />
                        </div>
                    </section>

                    {/* MODUL 05: SELBSTWAHRNEHMUNG */}
                    <section className="space-y-10">
                        <h3 className="text-[11px] font-black uppercase tracking-widest text-blue-600 mb-6 border-b pb-2">Modul 05: Psychosomatische Selbstwahrnehmung</h3>
                        <div className={noAnswers.bodySatisfaction ? 'opacity-30' : ''}>
                            <label className="text-sm font-bold text-slate-700 block mb-1">Wie zufrieden sind Sie mit Ihrem aktuellen Körperzustand (1-10)?</label>
                            <div className="flex items-center gap-4">
                                <input type="range" name="bodySatisfaction" min="1" max="10" disabled={noAnswers.bodySatisfaction} value={formData.bodySatisfaction} onChange={handleChange} className="flex-1 accent-blue-600" />
                                <span className="text-xs font-bold text-blue-600 w-4">{formData.bodySatisfaction}</span>
                            </div>
                            <NoAnswer field="bodySatisfaction" />
                        </div>
                        <div className={noAnswers.bodyChangeGoals ? 'opacity-30' : ''}>
                            <label className="text-sm font-bold text-slate-700 block mb-2">Gibt es spezifische Aspekte an Ihrem Körper, die Sie operativ ändern möchten?</label>
                            <textarea name="bodyChangeGoals" disabled={noAnswers.bodyChangeGoals} value={noAnswers.bodyChangeGoals ? '' : formData.bodyChangeGoals} placeholder="Beschreiben Sie hier Ihre Ziele..." onChange={handleChange} className="w-full p-4 bg-slate-50 border border-slate-100 rounded-lg outline-none h-20"></textarea>
                            <NoAnswer field="bodyChangeGoals" />
                        </div>
                        <div className={noAnswers.mentalHealth ? 'opacity-30' : ''}>
                            <label className="text-sm font-bold text-slate-700 block mb-2">Bestehen psychische Vorbelastungen oder befinden Sie sich in Behandlung?</label>
                            <textarea name="mentalHealth" disabled={noAnswers.mentalHealth} value={noAnswers.mentalHealth ? '' : formData.mentalHealth} placeholder="Depressionen, Angststörungen, etc..." onChange={handleChange} className="w-full p-4 bg-slate-50 border border-slate-100 rounded-lg outline-none h-20"></textarea>
                            <NoAnswer field="mentalHealth" />
                        </div>
                    </section>

                    {/* MODUL 06: INTIMITÄT */}
                    <section className="space-y-10">
                        <h3 className="text-[11px] font-black uppercase tracking-widest text-blue-600 mb-6 border-b pb-2">Modul 06: Reproduktive & Intime Analyse</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div className={noAnswers.partners ? 'opacity-30' : ''}>
                                <label className="text-sm font-bold text-slate-700 block mb-2">Anzahl Sexualpartner (Lebenszeit)?</label>
                                <input type="text" name="partners" disabled={noAnswers.partners} value={noAnswers.partners ? '' : formData.partners} placeholder="Anzahl..." onChange={handleChange} className="w-full py-2 outline-none border-b border-slate-200 bg-transparent" />
                                <NoAnswer field="partners" />
                            </div>
                            <div className={noAnswers.sexOrientation ? 'opacity-30' : ''}>
                                <label className="text-sm font-bold text-slate-700 block mb-2">Ihre sexuelle Orientierung?</label>
                                <select name="sexOrientation" disabled={noAnswers.sexOrientation} value={formData.sexOrientation} onChange={handleChange} className="w-full py-2 outline-none border-b border-slate-200 bg-transparent">
                                    <option value="">Wählen...</option><option value="hetero">Heterosexuell</option><option value="homo">Homosexuell</option><option value="bi">Bisexuell</option><option value="andere">Andere</option>
                                </select>
                                <NoAnswer field="sexOrientation" />
                            </div>
                        </div>
                        <div className={noAnswers.unprotectedSex ? 'opacity-30' : ''}>
                            <label className="text-sm font-bold text-slate-700 block mb-2">Wie oft praktizieren Sie ungeschützten Geschlechtsverkehr?</label>
                            <select name="unprotectedSex" disabled={noAnswers.unprotectedSex} value={formData.unprotectedSex} onChange={handleChange} className="w-full py-2 outline-none border-b border-slate-200 bg-transparent">
                                <option value="">Wählen...</option><option value="nie">Nie (Safe Sex)</option><option value="manchmal">Gelegentlich</option><option value="oft">Häufig ungeschützt</option>
                            </select>
                            <NoAnswer field="unprotectedSex" />
                        </div>
                        <div className={noAnswers.stis ? 'opacity-30' : ''}>
                            <label className="text-sm font-bold text-slate-700 block mb-2">Sind Ihnen aktuelle oder vergangene Geschlechtskrankheiten bekannt?</label>
                            <textarea name="stis" disabled={noAnswers.stis} value={noAnswers.stis ? '' : formData.stis} placeholder="HIV, Syphilis, HPV, etc..." onChange={handleChange} className="w-full p-4 bg-slate-50 border border-slate-100 rounded-lg outline-none h-20"></textarea>
                            <NoAnswer field="stis" />
                        </div>
                    </section>

                    {/* MODUL 07: FINANZEN */}
                    <section className="space-y-10">
                        <h3 className="text-[11px] font-black uppercase tracking-widest text-blue-600 mb-6 border-b pb-2">Modul 07: Sozio-Ökonomischer Status</h3>
                        <div className={noAnswers.income ? 'opacity-30' : ''}>
                            <label className="text-sm font-bold text-slate-700 block mb-2">Monatliches Netto-Einkommen?</label>
                            <select name="income" disabled={noAnswers.income} value={formData.income} onChange={handleChange} className="w-full py-2 outline-none border-b border-slate-200 bg-transparent">
                                <option value="">Wählen...</option><option value="1">Unter 1.500 €</option><option value="2">1.500 € - 3.500 €</option><option value="3">Über 3.500 €</option>
                            </select>
                            <NoAnswer field="income" />
                        </div>
                        <div className={noAnswers.debts ? 'opacity-30' : ''}>
                            <label className="text-sm font-bold text-slate-700 block mb-2">Bestehen finanzielle Schulden?</label>
                            <input type="text" name="debts" disabled={noAnswers.debts} value={noAnswers.debts ? '' : formData.debts} placeholder="Wenn ja, ungefähre Höhe..." onChange={handleChange} className="w-full py-2 outline-none border-b border-slate-200 bg-transparent" />
                            <NoAnswer field="debts" />
                        </div>
                    </section>

                    {/* ABSENDE-BEREICH */}
                    <div className="pt-10 flex flex-col items-center">
                        <button 
                            type="submit" 
                            disabled={timeLeft > 0 || !isFormComplete()} 
                            className={`w-full py-6 font-black text-xs uppercase tracking-[0.5em] shadow-2xl transition-all transform ${timeLeft > 0 || !isFormComplete() ? 'bg-slate-100 text-slate-300 cursor-not-allowed shadow-none' : 'bg-blue-600 text-white hover:bg-blue-700 active:scale-[0.98]'}`}
                        >
                            {!isFormComplete() ? 'BITTE ALLES AUSFÜLLEN ODER "KEINE ANGABE" WÄHLEN' : (timeLeft > 0 ? `Validierung läuft (${timeLeft}s)` : 'GESUNDHEITSPROFIL FINALISIEREN')}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    );
};
        const LoadingScreen = ({ onFinished }) => {
            useEffect(() => { const timer = setTimeout(onFinished, 3000); return () => clearTimeout(timer); }, []);
            return (<div className="min-h-screen bg-slate-900 flex flex-col items-center justify-center p-4 text-white"><div className="w-20 h-20 border-4 border-blue-500 border-t-transparent rounded-full animate-spin-slow mb-8"></div><h2 className="text-2xl font-bold mb-2">Algorithmus analysiert Profil...</h2><p className="text-slate-400">Suche passende Inhalte für Sie.</p></div>);
        };

        const EndScreen = ({ data, sessionToken }) => {
    const [targetUrl, setTargetUrl] = useState("");
    const fullDataString = JSON.stringify(data);

    useEffect(() => { 
        if (sessionToken) { 
            // Hier wird der fertige Link mit deinen Daten generiert
            const finalUrl = `${SOSCI_BASE_URL}?i=${sessionToken}&mydata=${encodeURIComponent(fullDataString)}`; 
            setTargetUrl(finalUrl); 
        } 
    }, [sessionToken, fullDataString]);

    return (
        <div className="min-h-screen bg-slate-900 flex flex-col items-center justify-center p-4 text-center">
            <div className="bg-white p-10 md:p-16 rounded-[40px] shadow-2xl max-w-lg w-full border-t-[12px] border-green-500 animate-fade-in text-slate-800">
                
                <h2 className="text-2xl md:text-3xl font-black mb-6 leading-tight">
                    Danke fürs Ausprobieren unserer Webseite!
                </h2>
                
                <p className="text-lg text-slate-600 mb-10 leading-relaxed">
                    Bitte beantworte nun noch ein paar abschließende Fragen. 
                    Klicke dazu bitte auf diesen Button, um zurück zum Fragebogen zu kommen:
                </p>

                {targetUrl ? (
                    <a 
                        href={targetUrl} 
                        className="block w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-5 rounded-2xl shadow-xl transition-all transform active:scale-95 no-underline text-xl"
                    >
                        Zurück zum Fragebogen
                    </a>
                ) : (
                    <div className="p-4 bg-red-50 text-red-600 rounded-xl text-sm font-medium border border-red-100">
                        Fehler: Sitzungstoken nicht gefunden. Bitte starten Sie die Umfrage erneut über SoSci Survey.
                    </div>
                )}
                
                <p className="mt-8 text-[10px] text-slate-400 uppercase tracking-widest font-bold">
                    Datenübertragung bereit
                </p>
            </div>
        </div>
    );
};

       function App() {
    const [step, setStep] = useState('intro');
    const [cookieChoice, setCookieChoice] = useState(null);
    const [bannerVisible, setBannerVisible] = useState(false);
    const [groupID, setGroupID] = useState(0);
    const [finalData, setFinalData] = useState({});
    const [sessionToken, setSessionToken] = useState(null);
    const timers = useRef({ blogStart: 0, bannerStart: 0, formStart: 0, postBrowsingStart: 0 });
    const [times, setTimes] = useState({ blogTime: 0, cookieTime: 0, registrationTime: 0, postBrowsingTime: 0 });
    const audioRef = useRef(null);
    const audioManRef = useRef(null);

    useEffect(() => {
        const params = new URLSearchParams(window.location.search);
        const g = parseInt(params.get('g')) || 0;
        setGroupID(g);
        const t = params.get('t');
        if (t) setSessionToken(t);
        audioRef.current = new Audio('sound.mp3'); audioRef.current.volume = 0.5;
        audioManRef.current = new Audio('soundmann.mp3'); audioManRef.current.volume = 0.5;
    }, []);

    const handleStartStudy = () => {
        const unlockAudio = (audioObj) => { if (audioObj) { audioObj.volume = 0; audioObj.play().then(() => { audioObj.pause(); audioObj.currentTime = 0; audioObj.volume = 0.5; }).catch(e => console.log("Unlock failed", e)); } };
        unlockAudio(audioRef.current); unlockAudio(audioManRef.current);
        timers.current.blogStart = Date.now(); setStep('blog'); setTimeout(() => setBannerVisible(true), COOKIE_BANNER_DELAY_MS);
    };

    const handleBannerLoad = () => { timers.current.bannerStart = Date.now(); };
    const handleCookieDecision = (decision) => { const duration = Date.now() - timers.current.bannerStart; setTimes(prev => ({ ...prev, cookieTime: duration })); setCookieChoice(decision); setBannerVisible(false); };
    const handleGoToRegistration = () => { const duration = Date.now() - timers.current.blogStart; setTimes(prev => ({ ...prev, blogTime: duration })); timers.current.formStart = Date.now(); setStep('register'); };
    const handleRegistrationSubmit = (formData) => { const duration = Date.now() - timers.current.formStart; setTimes(prev => ({ ...prev, registrationTime: duration })); setFinalData(prev => ({ ...prev, groupID: groupID, ...formData, cookieChoice: cookieChoice })); setStep('loading'); };
    const handleLoadingFinished = () => { timers.current.postBrowsingStart = Date.now(); setStep('personalized_blog'); };
    const handleFinishStudy = () => { const duration = Date.now() - timers.current.postBrowsingStart; const completeData = { ...finalData, ...times, postBrowsingTime: duration }; setFinalData(completeData); setStep('end'); };

    return (
    <div className="font-sans text-gray-800 antialiased selection:bg-blue-100 selection:text-blue-900">
        {step === 'intro' && <IntroScreen onStart={handleStartStudy} />}
        {step === 'blog' && (
            <>
                <BlogPage onAction={handleGoToRegistration} mode="initial" cookieChoice={cookieChoice} />
                {bannerVisible && (
                    <CookieBanner group={groupID} onDecision={handleCookieDecision} audioObject={audioRef.current} onBannerLoad={handleBannerLoad} />
                )}
            </>
        )}
        {step === 'register' && (
            <RegistrationForm onSubmit={handleRegistrationSubmit} group={groupID} audioObject={audioManRef.current} />
        )}
        {step === 'loading' && <LoadingScreen onFinished={handleLoadingFinished} />}
        {step === 'personalized_blog' && (
            <BlogPage onAction={handleFinishStudy} mode="personalized" cookieChoice={cookieChoice} />
        )}
        {step === 'end' && <EndScreen data={finalData} sessionToken={sessionToken} />}
    </div>
);
} // Hier wurde die Klammer geschlossen!
         const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

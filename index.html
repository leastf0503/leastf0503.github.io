<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VitalCore - Ihr Gesundheitsportal</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @keyframes slide-up { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        @keyframes pulse-slow { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes blink { 0%, 88%, 100% { transform: scaleY(1); } 92% { transform: scaleY(0.05); } }
        
        .animate-blink-1 { animation: blink 3s infinite; transform-origin: center; }
        .animate-blink-2 { animation: blink 3s infinite; animation-delay: 0.4s; transform-origin: center; }
        .animate-slide-up { animation: slide-up 0.5s ease-out forwards; }
        .animate-fade-in { animation: fade-in 0.8s ease-out forwards; }
        
        body { font-family: sans-serif; background-color: #f8fafc; color: #1e293b; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- KONFIGURATION ---
        const CONFIG = {
            minBrowsingTime1: 15,
            minRegistrationTime: 10,
            minBrowsingTime2: 15,
            cookieDelay: 3000,
            sosciUrl: "https://www.soscisurvey.de/BA25LeaPaula/"
        };

        // --- BLOG INHALTE ---
        const BLOG_DATA = [
            { id: 1, title: "Die 5 Säulen der Langlebigkeit", cat: "Forschung", time: "8 min", author: "Dr. Weber", image: "https://images.unsplash.com/photo-1476480862126-209bfaa8edc8?w=800", desc: "Kleine Anpassungen können Ihr biologisches Alter senken." },
            { id: 2, title: "Intervallfasten 16:8", cat: "Ernährung", time: "10 min", author: "S. Klein", image: "https://images.unsplash.com/photo-1498837167922-ddd27525d352?w=800", desc: "Warum Pausen wichtiger sind als Kalorienzählen." },
            { id: 3, title: "Digital Detox & Stress", cat: "Mental Health", time: "7 min", author: "M. Bauer", image: "https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?w=800", desc: "Wie das Smartphone Ihren Hormonhaushalt stört." },
            { id: 4, title: "Herzgesundheit 2.0", cat: "Prävention", time: "5 min", author: "Prof. Lang", image: "https://images.unsplash.com/photo-1505751172876-fa1923c5c528?w=800", desc: "Neue Marker im Blutbild, die Sie kennen sollten." },
            { id: 5, title: "Rauchen: Eine ist keine?", cat: "Prävention", time: "6 min", author: "Dr. Neubauer", image: "https://cdn.prod.www.spiegel.de/images/caa850d5-0001-0004-0000-000001220757_w1200_r1_fpx41.97_fpy50.jpg", desc: "Warum Social Smoking gefährlich bleibt." },
            { id: 6, title: "Diäten & Jojo-Effekt", cat: "Ernährung", time: "7 min", author: "Dr. Meier", image: "https://images.unsplash.com/photo-1490645935967-10de6ba17061?w=800", desc: "Warum Crash-Diäten langfristig scheitern." },
            { id: 7, title: "Volkskrankheit Rücken", cat: "Prävention", time: "8 min", author: "T. Müller", image: "ruecken.jpg", desc: "Übungen zur Linderung im Büro-Alltag." },
            { id: 8, title: "Migräne verstehen", cat: "Forschung", time: "7 min", author: "Dr. Neuhaus", image: "migraene.jpg", desc: "Ursachen und moderne Therapieansätze." },
            { id: 9, title: "Zone 2 Training", cat: "Fitness", time: "10 min", author: "Prof. Arndt", image: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=800", desc: "Warum langsam das neue schnell ist." },
            { id: 10, title: "Muskeln sind Medizin", cat: "Fitness", time: "6 min", author: "Dr. Reha", image: "https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=800", desc: "Krafttraining als Altersvorsorge." }
        ];

        // --- ICONS ---
        const IconShield = () => (<svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>);

        // --- KOMPONENTEN ---
        const RealisticEye = ({ color, blinkClass }) => (
            <div className={blinkClass}>
                <svg viewBox="0 0 100 70" className="w-20 h-14" style={{ overflow: 'visible' }}>
                    <path d="M5,35 Q50,-12 95,35 Q50,82 5,35 Z" fill="#fff" stroke="#333" strokeWidth="0.5" />
                    <circle cx="50" cy="35" r="17" fill={color} />
                    <circle cx="50" cy="35" r="8" fill="#000" />
                    <circle cx="45" cy="30" r="3.5" fill="#fff" opacity="0.8" />
                </svg>
            </div>
        );

        const Stimulus = ({ config, variant }) => {
            if (!config.eyes) return null;
            const eyeColor = variant === 'banner' ? '#3b82f6' : '#5D4037';
            return (
                <div className={`pointer-events-none z-[60] flex flex-col items-center gap-2 ${variant === 'form' ? 'fixed top-4 left-1/2 -translate-x-1/2' : 'absolute -top-16 left-1/2 -translate-x-1/2'}`}>
                    <div className="flex gap-4 filter drop-shadow-xl bg-white/80 p-2 rounded-full backdrop-blur">
                        <RealisticEye color={eyeColor} blinkClass="animate-blink-1" />
                        <RealisticEye color={eyeColor} blinkClass="animate-blink-2" />
                    </div>
                    {config.info && variant === 'form' && (
                        <div className="bg-red-600 text-white text-[10px] px-3 py-1 rounded-full font-bold animate-fade-in shadow-lg">
                            DATENÜBERWACHUNG AKTIV
                        </div>
                    )}
                </div>
            );
        };

        const App = () => {
            const [step, setStep] = useState('intro');
            const [banner, setBanner] = useState(false);
            const [finalData, setFinalData] = useState({});
            const [timer, setTimer] = useState(0);

            const params = useMemo(() => new URLSearchParams(window.location.search), []);
            const gID = parseInt(params.get('g')) || 0;
            const token = params.get('t') || "KEIN_TOKEN";

            const config = {
                eyes: [1, 3, 5, 7].includes(gID),
                sound: [2, 3, 6, 7].includes(gID),
                info: [5, 6, 7].includes(gID)
            };

            const playSound = () => {
                if (config.sound) {
                    const audio = new Audio('soundmann.mp3');
                    audio.play().catch(() => {});
                }
            };

            // Zeit-Tracker
            useEffect(() => {
                const interval = setInterval(() => setTimer(t => t + 1), 1000);
                return () => clearInterval(interval);
            }, []);

            if (step === 'intro') return (
                <div className="min-h-screen bg-slate-900 flex items-center justify-center p-6 text-center">
                    <div className="bg-white p-10 rounded-[40px] shadow-2xl max-w-sm animate-fade-in">
                        <h1 className="text-3xl font-black mb-4">VitalCore</h1>
                        <p className="text-slate-500 mb-8">Bereit für Ihre Analyse?</p>
                        <button onClick={() => {setStep('blog'); setTimeout(() => setBanner(true), CONFIG.cookieDelay);}} className="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold">Studie starten</button>
                    </div>
                </div>
            );

            if (step === 'blog' || step === 'personalized') {
                const isInitial = step === 'blog';
                const articles = isInitial ? BLOG_DATA : [{id: 101, title: "Ihre Analyse", cat: "EILMELDUNG", image: "https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?w=800", desc: "99% Match: Ihr Plan ist bereit."}, ...BLOG_DATA];
                const waitTime = isInitial ? CONFIG.minBrowsingTime1 : CONFIG.minBrowsingTime2;

                return (
                    <div className="min-h-screen bg-slate-50 pb-20">
                        <nav className="bg-white border-b p-4 sticky top-0 z-40 flex justify-between items-center shadow-sm">
                            <span className="font-black text-xl text-blue-600">VitalCore</span>
                            <button 
                                disabled={timer < waitTime}
                                onClick={() => isInitial ? setStep('form') : setStep('end')}
                                className="bg-slate-900 text-white px-6 py-2 rounded-full font-bold disabled:bg-slate-200"
                            >
                                {timer < waitTime ? `Warten (${waitTime - timer}s)` : (isInitial ? "Profil erstellen" : "Beenden")}
                            </button>
                        </nav>
                        <div className="max-w-6xl mx-auto p-6 grid md:grid-cols-3 gap-6">
                            {articles.map(art => (
                                <div key={art.id} className="bg-white rounded-3xl shadow-sm border overflow-hidden">
                                    <img src={art.image} className="h-40 w-full object-cover" />
                                    <div className="p-5"><h3 className="font-bold mb-2">{art.title}</h3><p className="text-xs text-slate-500">{art.desc}</p></div>
                                </div>
                            ))}
                        </div>
                        {banner && (
                            <div className="fixed bottom-0 left-0 right-0 bg-white p-6 shadow-[0_-10px_40px_rgba(0,0,0,0.1)] border-t-4 border-blue-600 animate-slide-up z-50">
                                <div className="max-w-4xl mx-auto flex flex-col md:flex-row items-center gap-6 relative">
                                    <Stimulus config={config} variant="banner" />
                                    <div className="flex-1"><h4 className="font-bold">Privatsphäre</h4><p className="text-xs">Wir teilen Ihre Daten mit Partnern.</p></div>
                                    <button onClick={() => {setBanner(false); setFinalData({...finalData, cookie: 'ok'});}} className="bg-blue-600 text-white px-8 py-2 rounded-xl font-bold">Akzeptieren</button>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            if (step === 'form') return (
                <div className="min-h-screen bg-slate-100 py-12 px-4 relative">
                    <Stimulus config={config} variant="form" />
                    <div className="max-w-2xl mx-auto bg-white rounded-[40px] shadow-2xl overflow-hidden z-10 relative">
                        <div className="bg-slate-900 p-8 text-white text-center"><h2 className="text-2xl font-bold">Gesundheitsprofil</h2></div>
                        <form className="p-8 space-y-10" onSubmit={(e) => {
                            e.preventDefault();
                            const d = new FormData(e.target);
                            const data = Object.fromEntries(d.entries());
                            setFinalData({...finalData, ...data});
                            setStep('loading');
                            setTimer(0);
                        }}>
                            <div className="grid grid-cols-2 gap-4">
                                <input name="age" placeholder="Alter" type="text" className="border p-4 rounded-2xl bg-slate-50" onFocus={playSound} required />
                                <select name="gender" className="border p-4 rounded-2xl bg-slate-50" onFocus={playSound}><option>Männlich</option><option>Weiblich</option></select>
                            </div>

                            {/* --- SENSIBLE FRAGEN --- */}
                            <div className="p-6 bg-red-50 border-l-8 border-red-500 rounded-2xl space-y-4">
                                <h3 className="font-bold text-red-900 italic">7. Medizinische Historie</h3>
                                <p className="text-xs text-red-700">Wurden bei Ihnen jemals folgende Diagnosen gestellt? (HIV, Krebs, Depression, STIs)</p>
                                <textarea name="med_history" placeholder="Ihre Diagnosen und Medikamente..." className="w-full border-red-100 p-4 rounded-xl text-sm" onFocus={playSound}></textarea>
                            </div>

                            <div className="p-6 bg-slate-100 border-l-8 border-slate-400 rounded-2xl space-y-4">
                                <h3 className="font-bold text-slate-800">8. Drogen & Suchtmittel</h3>
                                <select name="drugs" className="w-full border p-4 rounded-xl" onFocus={playSound}>
                                    <option value="">Konsum illegaler Drogen?</option>
                                    <option>Nie</option><option>Gelegentlich</option><option>Regelmäßig</option>
                                </select>
                            </div>

                            <div className="p-6 bg-purple-50 border-l-8 border-purple-500 rounded-2xl space-y-4">
                                <h3 className="font-bold text-purple-900 italic">9. Sexualität</h3>
                                <textarea name="sex_info" placeholder="Sexuelle Orientierung / STIs / Häufigkeit..." className="w-full border-purple-100 p-4 rounded-xl text-sm" onFocus={playSound}></textarea>
                            </div>

                            <button className="w-full bg-blue-600 text-white py-5 rounded-3xl font-black text-xl shadow-xl">Analyse jetzt starten</button>
                            <div className="text-center text-[10px] text-slate-400 flex items-center justify-center gap-1"><IconShield /> Ende-zu-Ende Verschlüsselung nach Art. 9 DSGVO</div>
                        </form>
                    </div>
                </div>
            );

            if (step === 'loading') {
                setTimeout(() => setStep('personalized'), 3000);
                return (
                    <div className="min-h-screen bg-slate-900 flex flex-col items-center justify-center text-white">
                        <div className="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-6"></div>
                        <p className="font-bold tracking-widest animate-pulse">BERECHNE PLAN...</p>
                    </div>
                );
            }

            if (step === 'end') {
                const finalUrl = `${CONFIG.sosciUrl}?i=${token}&mydata=${encodeURIComponent(JSON.stringify(finalData))}`;
                return (
                    <div className="min-h-screen bg-slate-900 flex items-center justify-center p-6 text-center">
                        <div className="bg-white p-12 rounded-[50px] shadow-2xl max-w-sm">
                            <h2 className="text-3xl font-bold mb-6">Fertig</h2>
                            <p className="text-slate-500 mb-10">Daten wurden übertragen.</p>
                            <a href={finalUrl} className="block w-full bg-blue-600 text-white py-5 rounded-3xl font-bold">Zurück zur Umfrage</a>
                        </div>
                    </div>
                );
            }
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
